/*!
 * license inazumatv.com
 * author (at)taikiken / http://inazumatv.com
 * date 2015/04/20 - 16:51
 *
 * Copyright (c) 2011-2015 inazumatv.com, inc.
 *
 * Distributed under the terms of the MIT license.
 * http://www.opensource.org/licenses/mit-license.html
 *
 * This notice shall be included in all copies or substantial portions of the Software.
 *
 * thanks
 * gl-matrix
 * https://github.com/toji/gl-matrix
 *
 * html5rocks.com
 * http://www.html5rocks.com/en/tutorials/canvas/imagefilters/
 *
 * Blur by Mario Klingemann
 * http://www.quasimondo.com/StackBlurForCanvas/StackBlurDemo.html
 *
 * version 0.0.1
 * build 2015-09-03 22:24:32
 * git https://github.com/taikiken/igata.js
 *
 */
var Igata=window.Igata||{};!function(t){"use strict";var n=t.Igata;n.Float32Array=t.Float32Array,n._random=Math.random,n._abs=Math.abs,n._min=Math.min,n._max=Math.max,n._sqrt=Math.sqrt,n._cos=Math.cos,n._sin=Math.sin,n._round=Math.round,n._floor=Math.floor,n._exp=Math.exp,n._PI=Math.PI,n.EPSILON=1e-6,n.extend=function(t,n){n.prototype=Object.create(t.prototype),n.prototype.constructor=n}}(window),function(t){"use strict";var n=t.Igata;n.Bitmap=function(){function t(t,n){var r=null;Object.defineProperties(this,{context:{get:function(){return t}},img:{get:function(){return n}},identity:{get:function(){return r},set:function(t){r=t}}})}var n=t.prototype;return n.constructor=t,n.get=function(t,n,r,e){var a=this.context,o=this.img;return o&&(r=r||o.width,e=e||o.height),t=t||0,n=n||0,a.getImageData(t,n,r,e)},n.save=function(t){this.identity=new Uint8ClampedArray(t)},t}()}(window),function(t){"use strict";var n=t.Igata;n.Filter=function(){function t(t){Object.defineProperties(this,{bitmap:{get:function(){return t},set:function(n){t=n}}})}var n=t.prototype;return n.constructor=t,n.filter=function(){},n.imageData=function(t){var n=t.get();return t.identity||t.save(n.data),n},n.restore=function(){var t,n=this.bitmap,r=n.get(),e=n.identity;e&&(r.data.set(e),t=n.context,t.putImageData(r,0,0))},t}()}(window),function(t){"use strict";var n=t.Igata;n.Invert=function(){function t(t){r.call(this,t)}var r=n.Filter;n.extend(r,t);var e=t.prototype;return e.constructor=t,e.filter=function(){var t,n,r,e,a=this.bitmap,o=a.context,i=this.imageData(a);for(t=i.data,n=0,r=t.length;r>n;n=n+4|0)e=n,t[e]=255-t[e],e=n+1,t[e]=255-t[e],e=n+2,t[e]=255-t[e];o.putImageData(i,0,0)},t}()}(window),function(t){"use strict";var n=t.Igata;n.Brightness=function(){function t(t){r.call(this,t)}var r=n.Filter;n.extend(r,t);var e=t.prototype;return e.constructor=t,e.filter=function(t){var n,r,e,a,o,i=this.bitmap,u=i.context,c=this.imageData(i);for(n=new Uint8ClampedArray(i.identity),r=2.55*t,a=0,o=n.length;o>a;a=a+4|0)e=a,n[e]=r+n[e],e=a+1,n[e]=r+n[e],e=a+2,n[e]=r+n[e];c.data.set(n),u.putImageData(c,0,0)},t}()}(window),function(t){"use strict";var n=t.Igata;n.Grayscale=function(){function t(t){r.call(this,t)}var r=n.Filter;n.extend(r,t);var e=t.prototype;return e.constructor=t,e.filter=function(){var t,n,r,e,a,o,i,u,c,f=this.bitmap,s=f.context,g=this.imageData(f);for(t=g.data,n=0,r=t.length;r>n;n=n+4|0)i=n+1,u=n+2,e=t[n],a=t[i],o=t[u],c=.2126*e+.7152*a+.0722*o,t[n]=t[i]=t[u]=c;s.putImageData(g,0,0)},t}()}(window),function(t){"use strict";var n=t.Igata;n.Threshold=function(){function t(t){r.call(this,t)}var r=n.Filter;n.extend(r,t);var e=t.prototype;return e.constructor=t,e.filter=function(t){var n,r,e,a,o,i,u,c,f,s=this.bitmap,g=s.context,l=this.imageData(s);for(t=t||128,n=l.data,r=0,e=n.length;e>r;r=r+4|0)u=r+1,c=r+2,a=n[r],o=n[u],i=n[c],f=.2126*a+.7152*o+.0722*i>=t?255:0,n[r]=n[u]=n[c]=f;g.putImageData(l,0,0)},t}()}(window),function(t){"use strict";var n=t.Igata,r=function(){function t(){var t=0,n=0,r=0,e=0,a=null;Object.defineProperties(this,{r:{get:function(){return t},set:function(n){t=n}},g:{get:function(){return n},set:function(t){n=t}},b:{get:function(){return r},set:function(t){r=t}},a:{get:function(){return e},set:function(t){e=t}},next:{get:function(){return a},set:function(t){a=t}}})}var n=t.prototype;return n.constructor=t,t}();n.Blur=function(){function t(t){e.call(this,t)}var e=n.Filter,a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],o=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];n.extend(e,t);var i=t.prototype;return i.constructor=t,i.filter=function(t,n){var r,e=this.bitmap,a=e.context,o=this.imageData(e);if(r=new Uint8ClampedArray(e.identity),isNaN(t)&&(t=8),t|=0,0!==t){n?this._rgba(r,t,o.width,o.height):this._rgb(r,t,o.width,o.height);Date.now();o.data.set(r),a.putImageData(o,0,0)}else this.restore()},i._rgba=function(t,n,e,i){var u,c,f,s,g,l,h,v,p,d,m,x,b,w,I,y,D,_,M,F,P,A,N,O,j,q=n+n+1,C=e-1,B=i-1,U=n+1,z=U*(U+1)/2,E=new r,G=E;for(f=1;q>f;f=f+1|0)G=G.next=new r,f===U&&(j=G);G.next=E;var L=null,S=null;h=l=0;var T=a[n],k=o[n];for(c=0;i>c;c=c+1|0){for(y=D=_=M=v=p=d=m=0,x=U*(F=t[l]),b=U*(P=t[l+1]),w=U*(A=t[l+2]),I=U*(N=t[l+3]),v+=z*F,p+=z*P,d+=z*A,m+=z*N,G=E,f=0;U>f;f=f+1|0)G.r=F,G.g=P,G.b=A,G.a=N,G=G.next;for(f=1;U>f;f=f+1|0)s=l+((f>C?C:f)<<2),v+=(G.r=F=t[s])*(O=U-f),p+=(G.g=P=t[s+1])*O,d+=(G.b=A=t[s+2])*O,m+=(G.a=N=t[s+3])*O,y+=F,D+=P,_+=A,M+=N,G=G.next;for(L=E,S=j,u=0;e>u;u=u+1|0)t[l+3]=N=m*T>>k,0!==N?(N=255/N,t[l]=(v*T>>k)*N,t[l+1]=(p*T>>k)*N,t[l+2]=(d*T>>k)*N):t[l]=t[l+1]=t[l+2]=0,v-=x,p-=b,d-=w,m-=I,x-=L.r,b-=L.g,w-=L.b,I-=L.a,s=h+((s=u+n+1)<C?s:C)<<2,y+=L.r=t[s],D+=L.g=t[s+1],_+=L.b=t[s+2],M+=L.a=t[s+3],v+=y,p+=D,d+=_,m+=M,L=L.next,x+=F=S.r,b+=P=S.g,w+=A=S.b,I+=N=S.a,y-=F,D-=P,_-=A,M-=N,S=S.next,l=l+4|0;h+=e}for(u=0;e>u;u=u+1|0){for(D=_=M=y=p=d=m=v=0,l=u<<2,x=U*(F=t[l]),b=U*(P=t[l+1]),w=U*(A=t[l+2]),I=U*(N=t[l+3]),v+=z*F,p+=z*P,d+=z*A,m+=z*N,G=E,f=0;U>f;f=f+1|0)G.r=F,G.g=P,G.b=A,G.a=N,G=G.next;for(g=e,f=1;n>=f;f=f+1|0)l=g+u<<2,v+=(G.r=F=t[l])*(O=U-f),p+=(G.g=P=t[l+1])*O,d+=(G.b=A=t[l+2])*O,m+=(G.a=N=t[l+3])*O,y+=F,D+=P,_+=A,M+=N,G=G.next,B>f&&(g+=e);for(l=u,L=E,S=j,c=0;i>c;c=c+1|0)s=l<<2,t[s+3]=N=m*T>>k,N>0?(N=255/N,t[s]=(v*T>>k)*N,t[s+1]=(p*T>>k)*N,t[s+2]=(d*T>>k)*N):t[s]=t[s+1]=t[s+2]=0,v-=x,p-=b,d-=w,m-=I,x-=L.r,b-=L.g,w-=L.b,I-=L.a,s=u+((s=c+U)<B?s:B)*e<<2,v+=y+=L.r=t[s],p+=D+=L.g=t[s+1],d+=_+=L.b=t[s+2],m+=M+=L.a=t[s+3],L=L.next,x+=F=S.r,b+=P=S.g,w+=A=S.b,I+=N=S.a,y-=F,D-=P,_-=A,M-=N,S=S.next,l+=e}},i._rgb=function(t,n,e,i){var u,c,f,s,g,l,h,v,p,d,m,x,b,w,I,y,D,_,M,F,P,A=n+n+1,N=e-1,O=i-1,j=n+1,q=j*(j+1)/2,C=new r,B=C;for(f=1;A>f;f=f+1|0)B=B.next=new r,f===j&&(P=B);B.next=C;var U=null,z=null;h=l=0;var E=a[n],G=o[n];for(c=0;i>c;c=c+1|0){for(w=I=y=v=p=d=0,m=j*(D=t[l]),x=j*(_=t[l+1]),b=j*(M=t[l+2]),v+=q*D,p+=q*_,d+=q*M,B=C,f=0;j>f;f=f+1|0)B.r=D,B.g=_,B.b=M,B=B.next;for(f=1;j>f;f=f+1|0)s=l+((f>N?N:f)<<2),v+=(B.r=D=t[s])*(F=j-f),p+=(B.g=_=t[s+1])*F,d+=(B.b=M=t[s+2])*F,w+=D,I+=_,y+=M,B=B.next;for(U=C,z=P,u=0;e>u;u=u+1|0)t[l]=v*E>>G,t[l+1]=p*E>>G,t[l+2]=d*E>>G,v-=m,p-=x,d-=b,m-=U.r,x-=U.g,b-=U.b,s=h+((s=u+n+1)<N?s:N)<<2,w+=U.r=t[s],I+=U.g=t[s+1],y+=U.b=t[s+2],v+=w,p+=I,d+=y,U=U.next,m+=D=z.r,x+=_=z.g,b+=M=z.b,w-=D,I-=_,y-=M,z=z.next,l=l+4|0;h+=e}for(u=0;e>u;u=u+1|0){for(I=y=w=p=d=v=0,l=u<<2,m=j*(D=t[l]),x=j*(_=t[l+1]),b=j*(M=t[l+2]),v+=q*D,p+=q*_,d+=q*M,B=C,f=0;j>f;f=f+1|0)B.r=D,B.g=_,B.b=M,B=B.next;for(g=e,f=1;n>=f;f=f+1|0)l=g+u<<2,v+=(B.r=D=t[l])*(F=j-f),p+=(B.g=_=t[l+1])*F,d+=(B.b=M=t[l+2])*F,w+=D,I+=_,y+=M,B=B.next,O>f&&(g+=e);for(l=u,U=C,z=P,c=0;i>c;c=c+1|0)s=l<<2,t[s]=v*E>>G,t[s+1]=p*E>>G,t[s+2]=d*E>>G,v-=m,p-=x,d-=b,m-=U.r,x-=U.g,b-=U.b,s=u+((s=c+j)<O?s:O)*e<<2,v+=w+=U.r=t[s],p+=I+=U.g=t[s+1],d+=y+=U.b=t[s+2],U=U.next,m+=D=z.r,x+=_=z.g,b+=M=z.b,w-=D,I-=_,y-=M,z=z.next,l+=e}},t}()}(window),function(t){"use strict";var n=t.Igata;n.Convolution=function(){function t(t){r.call(this,t)}var r=n.Filter,e=n._round,a=n._sqrt,o=n._floor,i=n._PI,u=n._exp;n.extend(r,t);var c=t.prototype;return c.constructor=t,c.filter=function(t){var n,r=this.bitmap,e=r.context,a=this.imageData(r);"undefined"==typeof t&&(t=[1,1,1,1,.7,-1,-1,-1,-1]),n=this.convolute(e,a,t,!0),e.putImageData(n,0,0)},c.sharpen=function(t){var n,r=this.bitmap,e=r.context,a=this.imageData(r),o=[0,-1,0,-1,5,-1,0,-1,0];t=!!t,n=this.convolute(e,a,o,t),e.putImageData(n,0,0)},c.blur=function(t){(isNaN(t)||0>=t)&&(t=1/9);var n,r=this.bitmap,e=r.context,a=this.imageData(r),o=[t,t,t,t,t,t,t,t,t];n=this.convolute(e,a,o,!1),e.putImageData(n,0,0)},c.gaussian=function(t){var n,r,e,o=this.bitmap,c=o.context,f=this.imageData(o),s=[],g=.849321800288,l=1/a(2*i)/g,h=0;for(r=-t;t>=r;r++)for(e=-t;t>=e;e++)h=l*u(-(e*e+r*r)/(2*g*g)),s.push(h);console.log("gaussian ",t,s),n=this.convolute(c,f,s,!1),c.putImageData(n,0,0)},c.convolute=function(t,n,r,i){var u,c,f,s,g,l,h,v,p,d,m,x,b,w,I,y=e(a(r.length)),D=o(.5*y),_=n.data,M=n.width,F=n.height,P=M,A=F,N=t.createImageData(P,A),O=N.data,j=i?1:0;for(u=0;A>u;u=u+1|0)for(c=0;P>c;c=c+1|0){for(f=u,s=c,g=4*(u*P+c),l=0,h=0,v=0,p=0,d=0;y>d;d=d+1|0)for(m=0;y>m;m=m+1|0)x=f+d-D,b=s+m-D,x>=0&&F>x&&b>=0&&M>b&&(w=4*(x*M+b),I=r[d*y+m],l+=_[w]*I,h+=_[w+1]*I,v+=_[w+2]*I,p+=_[w+3]*I);O[g]=l,O[g+1]=h,O[g+2]=v,O[g+3]=p+j*(255-p)}return N},t}()}(window),function(t){"use strict";var n=(t.document,t.Igata);n.Match=function(){function t(){}var r=n._abs,e=n._sqrt,a=t.prototype;return a.constructor=t,t.overall=function(t,n,r){var e,a,o=t[0].length===n[0].length?t[0].length:null,i=t.length===n.length?t.length:null;if(null===o||null===i)throw new Error("Matrices don't have the same size.");for(e=0;o>e;e=e+1|0)for(a=0;i>a;a=a+1|0)r(t[e][a],n[e][a])},t.mean=function(t){var n,r,e=0,a=t[0].length,o=t.length;for(n=0;a>n;n=n+1|0)for(r=0;o>r;r=r+1|0)e+=t[n][r];return console.log("mean ",e,a,o,e/(a*o)),e/(a*o)},t.sad=function(n,e){var a=0;return t.overall(n,e,function(t,n){a+=r(t-n)}),a},t.ssd=function(n,r){var e=0;return t.overall(n,r,function(t,n){var r=t-n;e+=r*r}),e},t.zncc=function(n,r){var a,o=t.mean(n),i=t.mean(r),u=0,c=0,f=0;return t.overall(n,r,function(t,n){var r=t-o,e=n-i;u+=r*e,c+=r*r,f+=e*e}),a=e(c*f),u/a},t}()}(window);