/*!
 * license inazumatv.com
 * author (at)taikiken / http://inazumatv.com
 * date 2015/04/20 - 16:51
 *
 * Copyright (c) 2011-2015 inazumatv.com, inc.
 *
 * Distributed under the terms of the MIT license.
 * http://www.opensource.org/licenses/mit-license.html
 *
 * This notice shall be included in all copies or substantial portions of the Software.
 *
 * thanks
 * gl-matrix
 * https://github.com/toji/gl-matrix
 *
 * html5rocks.com
 * http://www.html5rocks.com/en/tutorials/canvas/imagefilters/
 *
 * Blur by Mario Klingemann
 * http://www.quasimondo.com/StackBlurForCanvas/StackBlurDemo.html
 *
 * version 0.0.1
 * build 2015-09-11 20:03:30
 * git https://github.com/taikiken/igata.js
 *
 */
var Igata=window.Igata||{};!function(t,r){"use strict";function e(t){return 65280&t}function n(t){return 255&t}function a(t){return y[(65280&t)>>8]}var o=r;o.Float32Array=t.Float32Array,o._random=Math.random,o._abs=Math.abs,o._min=Math.min,o._max=Math.max,o._sqrt=Math.sqrt,o._cos=Math.cos,o._sin=Math.sin,o._round=Math.round,o._floor=Math.floor,o._exp=Math.exp,o._log=Math.log,o._pow=Math.pow,o._PI=Math.PI,o.extend=function(t,r){r.prototype=Object.create(t.prototype),r.prototype.constructor=r};var f=1.192092896e-7,i=1e-37,u=256,s=512,c=1024,d=2048,h=4096,l=1,p=2,v=3,g=4,y=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),w=0,_=1,x=2,b=3,m=1,B=1,k=2;o.U8_t=u,o.S32_t=s,o.F32_t=c,o.S64_t=d,o.F64_t=h,o.C1_t=l,o.C2_t=p,o.C3_t=v,o.C4_t=g,o.U8C1_t=u|l,o.U8C3_t=u|v,o.U8C4_t=u|g,o.F32C1_t=c|l,o.F32C2_t=c|p,o.S32C1_t=s|l,o.S32C2_t=s|p,o.EPSILON=f,o.FLT_MIN=i,o.COLOR_RGBA2GRAY=w,o.COLOR_RGB2GRAY=_,o.COLOR_BGRA2GRAY=x,o.COLOR_BGR2GRAY=b,o.BOX_BLUR_NOSCALE=m,o.SVD_U_T=B,o.SVD_V_T=k,o.get_data_type=e,o.get_channel=n,o.get_data_type_size=a}(window,Igata),function(t){"use strict";var r=t.Igata;r.Bitmap=function(){function t(t,r){this.identity=null,Object.defineProperties(this,{context:{get:function(){return t}},img:{get:function(){return r}}})}var r=t.prototype;return r.constructor=t,r.get=function(t,r,e,n){var a=this.context,o=this.img;return o&&(e=e||o.width,n=n||o.height),t=t||0,r=r||0,a.getImageData(t,r,e,n)},r.save=function(t){this.identity=new Uint8ClampedArray(t)},t}()}(window),function(t){"use strict";var r=t.Igata;r.Filter=function(){function t(t){Object.defineProperties(this,{bitmap:{get:function(){return t},set:function(r){t=r}}})}var r=t.prototype;return r.constructor=t,r.filter=function(){},r.imageData=function(t){var r=t.get();return t.identity||t.save(r.data),r},r.restore=function(){var t,r=this.bitmap,e=r.get(),n=r.identity;n&&(e.data.set(n),t=r.context,t.putImageData(e,0,0))},t}()}(window),function(t){"use strict";var r=t.Igata;r.Invert=function(){function t(t){e.call(this,t)}var e=r.Filter;r.extend(e,t);var n=t.prototype;return n.constructor=t,n.filter=function(){var t,r,e,n,a=this.bitmap,o=a.context,f=this.imageData(a);for(t=f.data,r=0,e=t.length;e>r;r=r+4|0)n=r,t[n]=255-t[n],n=r+1,t[n]=255-t[n],n=r+2,t[n]=255-t[n];o.putImageData(f,0,0)},t}()}(window),function(t){"use strict";var r=t.Igata;r.Brightness=function(){function t(t){e.call(this,t)}var e=r.Filter;r.extend(e,t);var n=t.prototype;return n.constructor=t,n.filter=function(t){var r,e,n,a,o,f=this.bitmap,i=f.context,u=this.imageData(f);for(r=new Uint8ClampedArray(f.identity),e=2.55*t,a=0,o=r.length;o>a;a=a+4|0)n=a,r[n]=e+r[n],n=a+1,r[n]=e+r[n],n=a+2,r[n]=e+r[n];u.data.set(r),i.putImageData(u,0,0)},t}()}(window),function(t){"use strict";var r=t.Igata;r.Grayscale=function(){function t(t){e.call(this,t)}var e=r.Filter;r.extend(e,t);var n=t.prototype;return n.constructor=t,n.filter=function(){var r=this.bitmap,e=r.context,n=this.imageData(r);t.to(n.data),e.putImageData(n,0,0)},t.to=function(t){var r,e,n,a,o,f,i;for(r=0,e=t.length;e>r;r=r+4|0)n=r+1,a=r+2,o=t[r],f=t[n],i=t[a],t[r]=t[n]=t[a]=.2126*o+.7152*f+.0722*i},t}()}(window),function(t){"use strict";var r=t.Igata;r.Sepia=function(){function t(t){e.call(this,t)}var e=r.Filter;r.extend(e,t);var n=t.prototype;return n.constructor=t,n.filter=function(){var t,r,e,n,a,o,f,i,u=this.bitmap,s=u.context,c=this.imageData(u);for(t=c.data,r=0,e=t.length;e>r;r=r+4|0)n=r+1,a=r+2,o=t[r],f=t[n],i=t[a],t[r]=.393*o+.769*f+.189*i,t[n]=.349*o+.686*f+.168*i,t[a]=.272*o+.534*f+.131*i;s.putImageData(c,0,0)},t}()}(window),function(t){"use strict";var r=t.Igata;r.Threshold=function(){function t(t){e.call(this,t)}var e=r.Filter;r.extend(e,t);var n=t.prototype;return n.constructor=t,n.filter=function(t){var r,e,n,a,o,f,i,u,s,c=this.bitmap,d=c.context,h=this.imageData(c);for(t=t||128,r=h.data,e=0,n=r.length;n>e;e=e+4|0)i=e+1,u=e+2,a=r[e],o=r[i],f=r[u],s=.2126*a+.7152*o+.0722*f>=t?255:0,r[e]=r[i]=r[u]=s;d.putImageData(h,0,0)},t}()}(window),function(t){"use strict";var r=t.Igata,e=function(){function t(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var r=t.prototype;return r.constructor=t,t}();r.Blur=function(){function t(t){n.call(this,t)}var n=r.Filter,a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],o=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];r.extend(n,t);var f=t.prototype;return f.constructor=t,f.filter=function(t,r){var e,n=this.bitmap,a=n.context,o=this.imageData(n);e=new Uint8ClampedArray(n.identity),isNaN(t)&&(t=8),t|=0,0!==t?(r?this._rgba(e,t,o.width,o.height):this._rgb(e,t,o.width,o.height),o.data.set(e),a.putImageData(o,0,0)):this.restore()},f._rgba=function(t,r,n,f){var i,u,s,c,d,h,l,p,v,g,y,w,_,x,b,m,B,k,M,I,z,A,C,D,S,O=r+r+1,R=n-1,E=f-1,U=r+1,F=U*(U+1)/2,L=new e,T=L;for(s=1;O>s;s=s+1|0)T=T.next=new e,s===U&&(S=T);T.next=L;var G=null,P=null;l=h=0;var N=a[r],V=o[r];for(u=0;f>u;u=u+1|0){for(m=B=k=M=p=v=g=y=0,w=U*(I=t[h]),_=U*(z=t[h+1]),x=U*(A=t[h+2]),b=U*(C=t[h+3]),p+=F*I,v+=F*z,g+=F*A,y+=F*C,T=L,s=0;U>s;s=s+1|0)T.r=I,T.g=z,T.b=A,T.a=C,T=T.next;for(s=1;U>s;s=s+1|0)c=h+((s>R?R:s)<<2),p+=(T.r=I=t[c])*(D=U-s),v+=(T.g=z=t[c+1])*D,g+=(T.b=A=t[c+2])*D,y+=(T.a=C=t[c+3])*D,m+=I,B+=z,k+=A,M+=C,T=T.next;for(G=L,P=S,i=0;n>i;i=i+1|0)t[h+3]=C=y*N>>V,0!==C?(C=255/C,t[h]=(p*N>>V)*C,t[h+1]=(v*N>>V)*C,t[h+2]=(g*N>>V)*C):t[h]=t[h+1]=t[h+2]=0,p-=w,v-=_,g-=x,y-=b,w-=G.r,_-=G.g,x-=G.b,b-=G.a,c=l+((c=i+r+1)<R?c:R)<<2,m+=G.r=t[c],B+=G.g=t[c+1],k+=G.b=t[c+2],M+=G.a=t[c+3],p+=m,v+=B,g+=k,y+=M,G=G.next,w+=I=P.r,_+=z=P.g,x+=A=P.b,b+=C=P.a,m-=I,B-=z,k-=A,M-=C,P=P.next,h=h+4|0;l+=n}for(i=0;n>i;i=i+1|0){for(B=k=M=m=v=g=y=p=0,h=i<<2,w=U*(I=t[h]),_=U*(z=t[h+1]),x=U*(A=t[h+2]),b=U*(C=t[h+3]),p+=F*I,v+=F*z,g+=F*A,y+=F*C,T=L,d=n,s=0;U>s;s=s+1|0)T.r=I,T.g=z,T.b=A,T.a=C,T=T.next;for(s=1;r>=s;s=s+1|0)h=d+i<<2,p+=(T.r=I=t[h])*(D=U-s),v+=(T.g=z=t[h+1])*D,g+=(T.b=A=t[h+2])*D,y+=(T.a=C=t[h+3])*D,m+=I,B+=z,k+=A,M+=C,T=T.next,E>s&&(d+=n);for(h=i,G=L,P=S,u=0;f>u;u=u+1|0)c=h<<2,t[c+3]=C=y*N>>V,C>0?(C=255/C,t[c]=(p*N>>V)*C,t[c+1]=(v*N>>V)*C,t[c+2]=(g*N>>V)*C):t[c]=t[c+1]=t[c+2]=0,p-=w,v-=_,g-=x,y-=b,w-=G.r,_-=G.g,x-=G.b,b-=G.a,c=i+((c=u+U)<E?c:E)*n<<2,p+=m+=G.r=t[c],v+=B+=G.g=t[c+1],g+=k+=G.b=t[c+2],y+=M+=G.a=t[c+3],G=G.next,w+=I=P.r,_+=z=P.g,x+=A=P.b,b+=C=P.a,m-=I,B-=z,k-=A,M-=C,P=P.next,h+=n}},f._rgb=function(t,r,n,f){var i,u,s,c,d,h,l,p,v,g,y,w,_,x,b,m,B,k,M,I,z,A=r+r+1,C=n-1,D=f-1,S=r+1,O=S*(S+1)/2,R=new e,E=R;for(s=1;A>s;s=s+1|0)E=E.next=new e,s===S&&(z=E);E.next=R;var U=null,F=null;l=h=0;var L=a[r],T=o[r];for(u=0;f>u;u=u+1|0){for(x=b=m=p=v=g=0,y=S*(B=t[h]),w=S*(k=t[h+1]),_=S*(M=t[h+2]),p+=O*B,v+=O*k,g+=O*M,E=R,s=0;S>s;s=s+1|0)E.r=B,E.g=k,E.b=M,E=E.next;for(s=1;S>s;s=s+1|0)c=h+((s>C?C:s)<<2),p+=(E.r=B=t[c])*(I=S-s),v+=(E.g=k=t[c+1])*I,g+=(E.b=M=t[c+2])*I,x+=B,b+=k,m+=M,E=E.next;for(U=R,F=z,i=0;n>i;i=i+1|0)t[h]=p*L>>T,t[h+1]=v*L>>T,t[h+2]=g*L>>T,p-=y,v-=w,g-=_,y-=U.r,w-=U.g,_-=U.b,c=l+((c=i+r+1)<C?c:C)<<2,x+=U.r=t[c],b+=U.g=t[c+1],m+=U.b=t[c+2],p+=x,v+=b,g+=m,U=U.next,y+=B=F.r,w+=k=F.g,_+=M=F.b,x-=B,b-=k,m-=M,F=F.next,h=h+4|0;l+=n}for(i=0;n>i;i=i+1|0){for(b=m=x=v=g=p=0,h=i<<2,y=S*(B=t[h]),w=S*(k=t[h+1]),_=S*(M=t[h+2]),p+=O*B,v+=O*k,g+=O*M,E=R,d=n,s=0;S>s;s=s+1|0)E.r=B,E.g=k,E.b=M,E=E.next;for(s=1;r>=s;s=s+1|0)h=d+i<<2,p+=(E.r=B=t[h])*(I=S-s),v+=(E.g=k=t[h+1])*I,g+=(E.b=M=t[h+2])*I,x+=B,b+=k,m+=M,E=E.next,D>s&&(d+=n);for(h=i,U=R,F=z,u=0;f>u;u=u+1|0)c=h<<2,t[c]=p*L>>T,t[c+1]=v*L>>T,t[c+2]=g*L>>T,p-=y,v-=w,g-=_,y-=U.r,w-=U.g,_-=U.b,c=i+((c=u+S)<D?c:D)*n<<2,p+=x+=U.r=t[c],v+=b+=U.g=t[c+1],g+=m+=U.b=t[c+2],U=U.next,y+=B=F.r,w+=k=F.g,_+=M=F.b,x-=B,b-=k,m-=M,F=F.next,h+=n}},t}()}(window),function(t){"use strict";var r=t.Igata;r.Convolution=function(){function t(t){e.call(this,t)}var e=r.Filter,n=r._round,a=r._sqrt,o=r._floor,f=r._PI,i=r._exp;r.extend(e,t);var u=t.prototype;return u.constructor=t,u.filter=function(t){var r,e=this.bitmap,n=e.context,a=this.imageData(e);"undefined"==typeof t&&(t=[1,1,1,1,.7,-1,-1,-1,-1]),r=this.convolute(n,a,t,!0),n.putImageData(r,0,0)},u.sharpen=function(t){var r,e=this.bitmap,n=e.context,a=this.imageData(e),o=[0,-1,0,-1,5,-1,0,-1,0];t=!!t,r=this.convolute(n,a,o,t),n.putImageData(r,0,0)},u.blur=function(t){(isNaN(t)||0>=t)&&(t=1/9);var r,e=this.bitmap,n=e.context,a=this.imageData(e),o=[t,t,t,t,t,t,t,t,t];r=this.convolute(n,a,o,!1),n.putImageData(r,0,0)},u.gaussian=function(t){var r,e,n,o=this.bitmap,u=o.context,s=this.imageData(o),c=[],d=.849321800288,h=1/a(2*f)/d,l=0;for(e=-t;t>=e;e++)for(n=-t;t>=n;n++)l=h*i(-(n*n+e*e)/(2*d*d)),c.push(l);console.log("gaussian ",t,c),r=this.convolute(u,s,c,!1),u.putImageData(r,0,0)},u.convolute=function(t,r,e,f){var i,u,s,c,d,h,l,p,v,g,y,w,_,x,b,m=n(a(e.length)),B=o(.5*m),k=r.data,M=r.width,I=r.height,z=M,A=I,C=t.createImageData(z,A),D=C.data,S=f?1:0;for(i=0;A>i;i=i+1|0)for(u=0;z>u;u=u+1|0){for(s=i,c=u,d=4*(i*z+u),h=0,l=0,p=0,v=0,g=0;m>g;g=g+1|0)for(y=0;m>y;y=y+1|0)w=s+g-B,_=c+y-B,w>=0&&I>w&&_>=0&&M>_&&(x=4*(w*M+_),b=e[g*m+y],h+=k[x]*b,l+=k[x+1]*b,p+=k[x+2]*b,v+=k[x+3]*b);D[d]=h,D[d+1]=l,D[d+2]=p,D[d+3]=v+S*(255-v)}return C},t}()}(window),function(t){"use strict";var r=(t.document,t.Igata);r.Match=function(){function t(){}var e=r._abs,n=r._sqrt,a=t.prototype;return a.constructor=t,t.overall=function(t,r,e){var n,a,o=t[0].length===r[0].length?t[0].length:null,f=t.length===r.length?t.length:null;if(null===o||null===f)throw new Error("Matrices don't have the same size.");for(n=0;o>n;n=n+1|0)for(a=0;f>a;a=a+1|0)e(t[n][a],r[n][a])},t.mean=function(t){var r,e,n=0,a=t[0].length,o=t.length;for(r=0;a>r;r=r+1|0)for(e=0;o>e;e=e+1|0)n+=t[r][e];return console.log("mean ",n,a,o,n/(a*o)),n/(a*o)},t.sad=function(r,n){var a=0;return t.overall(r,n,function(t,r){a+=e(t-r)}),a},t.ssd=function(r,e){var n=0;return t.overall(r,e,function(t,r){var e=t-r;n+=e*e}),n},t.zncc=function(r,e){var a,o=t.mean(r),f=t.mean(e),i=0,u=0,s=0;return t.overall(r,e,function(t,r){var e=t-o,n=r-f;i+=e*n,u+=e*e,s+=n*n}),a=n(u*s),i/a},t}()}(window),function(t){"use strict";var r=(t.document,t.Igata);r.Template=function(){function t(){}var e=r.Grayscale,n=r._abs,a=t.prototype;return a.constructor=t,a.match=function(t,r,n){var a,o,f,i,u,s,c,d,h,l,p,v,g,y=new Uint8ClampedArray(t.data),w=new Uint8ClampedArray(r.data);for(n=n||.9,e.to(y),e.to(w),a=t.height,o=t.width,f=r.height,i=r.width,u=0,s=a-f+1;s>u;u=u+1|0)for(c=0,d=o-i+1;d>c;c=c+1|0)for(p=0,h=0;f>h;h=h+1|0)for(l=0;i>l;l=l+1|0)g=l+i*h,v=c+l+o*(u+h),y[v]===w[g]&&(p=p+1|0);return p>=i*f*n},a.sad=function(t,r,a){var o,f,i,u,s,c,d,h,l,p,v,g,y,w,_,x,b,m=new Uint8ClampedArray(t.data),B=new Uint8ClampedArray(r.data);a=a||.2,e.to(m),e.to(B),o=t.height,f=t.width,i=r.height,u=r.width,b=u*i*256;var k=Date.now();for(console.log("sad ",k),s=0,c=o-i+1;c>s;s=s+1|0)for(d=0,h=f-u+1;h>d;d=d+1|0){for(v=0,g=0,_=!1,l=0;i>l;l=l+1|0)if(!_)for(p=0;u>p;p=p+1|0)_||(w=p+u*l,y=d+p+f*(s+l),v+=n(m[y]-B[w]),g=v/b,g>a&&(_=!0));a>=g&&(a=g,console.log("normal ",g,v,b),x={normalize:g,similar:v,x:d,y:s,width:u,height:i})}return console.log("------------------------- ",(Date.now()-k)/1e3),x},t}()}(window),function(t){"use strict";var r=t.Igata,e=r;e.Cascade=function(){function t(){throw new Error("Cascade can't create instance.")}var r=t.prototype;return r.constructor=t,t}()}(window),function(t){"use strict";function r(t){return 65280&t}function e(t){return 255&t}function n(t){return s[(65280&t)>>8]}var a=t.Igata,o=a,f=o.U8_t,i=o.S32_t,u=o.F32_t,s=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]);o.dataType=r,o.get_data_type=r,o.channel=e,o.get_channel=e,o.dataTypeSize=n,o.get_data_type_size=n;var c=function(){function t(t,r){this.size=-8&(t+7|0),"undefined"==typeof r?this.buffer=new ArrayBuffer(this.size):(this.buffer=r,this.size=r.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}var r=t.prototype;return r.constructor=t,t}(),d=function(){function t(t,n,a,o){this.type=0|r(a),this.channel=0|e(a),this.cols=0|t,this.rows=0|n,"undefined"==typeof o?this.allocate():(this.buffer=o,this.data=this.type&f?this.buffer.u8:this.type&i?this.buffer.i32:this.type&u?this.buffer.f32:this.buffer.f64)}var a=t.prototype;return a.constructor=t,a.allocate=function(){delete this.data,delete this.buffer,this.buffer=new c(this.cols*n(this.type)*this.channel*this.rows),this.data=this.type&f?this.buffer.u8:this.type&i?this.buffer.i32:this.type&u?this.buffer.f32:this.buffer.f64},a.copy=function(t){for(var r=t.data,e=this.data,n=0,a=this.cols*this.rows*this.channel|0,o=a-4;o>n;n+=4)r[n]=e[n],r[n+1]=e[n+1],r[n+2]=e[n+2],r[n+3]=e[n+3];for(;a>n;++n)r[n]=e[n]},a.copy_to=function(t){this.copy(t)},a.resize=function(t,r,e){"undefined"==typeof e&&(e=this.channel);var a=t*n(this.type)*e*r;a>this.buffer.size?(this.cols=t,this.rows=r,this.channel=e,this.allocate()):(this.cols=t,this.rows=r,this.channel=e)},t}(),h=function(){function t(t,r,e,n,a){"undefined"==typeof t&&(t=0),"undefined"==typeof r&&(r=0),"undefined"==typeof e&&(e=0),"undefined"==typeof n&&(n=0),"undefined"==typeof a&&(a=-1),this.x=t,this.y=r,this.score=e,this.level=n,this.angle=a}var r=t.prototype;return r.constructor=t,t}();o.Data_t=c,o.Matrix_t=d,o.Keypoint_t=h}(window),function(t){"use strict";var r=t.Igata,e=r,n=e.Data_t,a=function(){function t(t){this.next=null;var r=new n(t);this.data=r,this.size=r.size,this.buffer=r.buffer,this.u8=r.u8,this.i32=r.i32,this.f32=r.f32,this.f64=r.f64}var r=t.prototype;return r.constructor=t,r.resize=function(t){delete this.data;var r=new n(t);this.data=r,this.size=r.size,this.buffer=r.buffer,this.u8=r.u8,this.i32=r.i32,this.f32=r.f32,this.f64=r.f64},t}(),o=function(){function t(){throw new Error("Cache can't create instance.")}var r,e,n=0,o=t.prototype;return o.constructor=t,t.allocate=function(t,o){var f,i;for(r=e=new a(o),i=0;t>i;++i)f=new a(o),e=e.next=f,n++},t.getBuffer=function(t){var e=r;return r=r.next,n--,t>e.size&&e.resize(t),e},t.get_buffer=function(r){return t.getBuffer(r)},t.putBuffer=function(t){e=e.next=t,n++},t.put_buffer=function(r){t.putBuffer(r)},t}();o.allocate(30,2560),e.Cache=o}(window),function(t){"use strict";var r=t.Igata,e=r;e.Calc=function(){function t(){throw new Error("Calc can't create instance.")}var r=e.Cache,n=e.U8_t,a=new Int32Array(96),o=e._exp,f=e._min,i=t.prototype;return i.constructor=t,t.kernel=function(t,e,a,f){var i=0,u=0,s=0,c=0,d=0,h=0,l=r.getBuffer(t<<2),p=l.f32;if(1===(1&t)&&7>=t&&0>=e)switch(t>>1){case 0:p[0]=1,h=1;break;case 1:p[0]=.25,p[1]=.5,p[2]=.25,h=1;break;case 2:p[0]=.0625,p[1]=.25,p[2]=.375,p[3]=.25,p[4]=.0625,h=1;break;case 3:p[0]=.03125,p[1]=.109375,p[2]=.21875,p[3]=.28125,p[4]=.21875,p[5]=.109375,p[6]=.03125,h=1}else for(c=e>0?e:.3*(.5*(t-1)-1)+.8,d=-.5/(c*c);t>i;++i)u=i-.5*(t-1),s=o(d*u*u),p[i]=s,h+=s;if(f&n)for(h=256/h,i=0;t>i;++i)a[i]=p[i]*h+.5|0;else for(h=1/h,i=0;t>i;++i)a[i]=p[i]*h;r.putBuffer(l)},t.get_gaussian_kernel=function(r,e,n,a){t.kernel(r,e,n,a)},t.perspective4=function(t,r,e,n,a,o,f,i,u,s,c,d,h,l,p,v,g){var y=r,w=s,_=f,x=y*w*_,b=p,m=y*b,B=w*m,k=c,M=y*k,I=o,z=e,A=l,C=z*A,D=C*I,S=A*I*k,O=A*_,R=A*k,E=w*_,U=b*w,F=b*I,L=k*I,T=1/(O-R-E+U-F+L),G=y*A,P=z*I,N=_*y,V=b*N,q=z*w,Y=C*k,j=z*k*I,H=_*b*w,K=b*z,Q=-(B-x+M*I-I*m-C*w+D-S+O*w)*T,X=(x-B-G*_+G*k+D-w*P+F*w-S)*T,J=y,W=(-k*m+V+q*_-C*_+Y-j+F*k-H)*T,Z=(-V+N*k-K*w+Y-j+K*I+H-O*k)*T,$=z,tt=(-M+N+q-P+R-O-U+F)*T,rt=(-m+M+C-q+F-L-O+E)*T;y=n,w=d,_=u,x=y*w*_,b=g,m=y*b,B=w*m,k=h,M=y*k,I=i,z=a,A=v,C=z*A,D=C*I,S=A*I*k,O=A*_,R=A*k,E=w*_,U=b*w,F=b*I,L=k*I,T=1/(O-R-E+U-F+L),G=y*A,P=z*I,N=_*y,V=b*N,q=z*w,Y=C*k,j=z*k*I,H=_*b*w,K=b*z;var et=-(B-x+M*I-I*m-C*w+D-S+O*w)*T,nt=(x-B-G*_+G*k+D-w*P+F*w-S)*T,at=y,ot=(-k*m+V+q*_-C*_+Y-j+F*k-H)*T,ft=(-V+N*k-K*w+Y-j+K*I+H-O*k)*T,it=z,ut=(-M+N+q-P+R-O-U+F)*T,st=(-m+M+C-q+F-L-O+E)*T;w=Z-rt*$,_=Q*Z,x=Q*$,m=W*X,B=J*W,M=X*tt;var ct=J*tt;A=1/(_-x*rt-m+B*rt+M*$-ct*Z),D=-W+$*tt;var dt=-W*rt+Z*tt;L=-X+J*rt;var ht=Q-ct;P=Q*rt-M,N=-X*$+J*Z;var lt=x-B,pt=_-m;j=w*A;var vt=L*A,gt=N*A,yt=t.data;yt[0]=et*j+nt*(D*A)-at*(dt*A),yt[1]=et*vt+nt*(ht*A)-at*(P*A),yt[2]=-et*gt-nt*(lt*A)+at*(pt*A),yt[3]=ot*j+ft*(D*A)-it*(dt*A),yt[4]=ot*vt+ft*(ht*A)-it*(P*A),yt[5]=-ot*gt-ft*(lt*A)+it*(pt*A),yt[6]=ut*j+st*(D*A)-dt*A,yt[7]=ut*vt+st*(ht*A)-P*A,yt[8]=-ut*gt-st*(lt*A)+pt*A},t.perspective_4point_transform=function(r,e,n,a,o,f,i,u,s,c,d,h,l,p,v,g,y){t.perspective4(r,e,n,a,o,f,i,u,s,c,d,h,l,p,v,g,y)},t.qsort=function(t,r,e,n){var o,i,u,s,c=7,d=0,h=0,l=0,p=0,v=0,g=0,y=0,w=0,_=0,x=0,b=0,m=0,B=0,k=0,M=0,I=0,z=0,A=0,C=a;if(!(1>=e-r+1))for(C[0]=r,C[1]=e;d>=0;)for(h=C[d<<1],l=C[(d<<1)+1],d--;;){if(v=l-h+1,c>=v){for(y=h+1;l>=y;y++)for(w=y;w>h&&n(t[w],t[w-1]);w--)o=t[w],t[w]=t[w-1],t[w-1]=o;break}for(A=0,x=h,m=l,k=h+(v>>1),v>40&&(_=v>>3,M=h,I=h+_,z=h+(_<<1),i=t[M],u=t[I],s=t[z],h=n(i,u)?n(u,s)?I:n(i,s)?z:M:n(s,u)?I:n(i,s)?M:z,M=k-_,I=k,z=k+_,i=t[M],u=t[I],s=t[z],k=n(i,u)?n(u,s)?I:n(i,s)?z:M:n(s,u)?I:n(i,s)?M:z,M=l-(_<<1),I=l-_,z=l,i=t[M],u=t[I],s=t[z],l=n(i,u)?n(u,s)?I:n(i,s)?z:M:n(s,u)?I:n(i,s)?M:z),M=h,I=k,z=l,i=t[M],u=t[I],s=t[z],k=n(i,u)?n(u,s)?I:n(i,s)?z:M:n(s,u)?I:n(i,s)?M:z,k!==x&&(o=t[k],t[k]=t[x],t[x]=o,k=x),h=b=x+1,l=B=m,i=t[k];;){for(;l>=h&&!n(i,t[h]);)n(t[h],i)||(h>b&&(o=t[b],t[b]=t[h],t[h]=o),A=1,b++),h++;for(;l>=h&&!n(t[l],i);)n(i,t[l])||(B>l&&(o=t[B],t[B]=t[l],t[l]=o),A=1,B--),l--;if(h>l)break;o=t[h],t[h]=t[l],t[l]=o,A=1,h++,l--}if(0===A){for(h=x,l=m,y=h+1;l>=y;y++)for(w=y;w>h&&n(t[w],t[w-1]);w--)o=t[w],t[w]=t[w-1],t[w-1]=o;break}for(v=f(b-x,h-b),g=h-v|0,p=0;v>p;++p,++g)o=t[x+p],t[x+p]=t[g],t[g]=o;for(v=f(m-B,B-l),g=m-v+1|0,p=0;v>p;++p,++g)o=t[h+p],t[h+p]=t[g],t[g]=o;if(v=h-b,g=B-l,v>1)g>1?v>g?(++d,C[d<<1]=x,C[(d<<1)+1]=x+v-1,h=m-g+1,l=m):(++d,C[d<<1]=m-g+1,C[(d<<1)+1]=m,h=x,l=x+v-1):(h=x,l=x+v-1);else{if(!(g>1))break;h=m-g+1,l=m}}},t.median=function(t,r,e){for(var n,a=0,o=0,f=0,i=r+e>>1;;){if(r>=e)return t[i];if(e===r+1)return t[r]>t[e]&&(n=t[r],t[r]=t[e],t[e]=n),t[i];for(a=r+e>>1,t[a]>t[e]&&(n=t[a],t[a]=t[e],t[e]=n),t[r]>t[e]&&(n=t[r],t[r]=t[e],t[e]=n),t[a]>t[r]&&(n=t[a],t[a]=t[r],t[r]=n),o=r+1,n=t[a],t[a]=t[o],t[o]=n,f=e;;){do++o;while(t[r]>t[o]);do--f;while(t[f]>t[r]);if(o>f)break;n=t[o],t[o]=t[f],t[f]=n}n=t[r],t[r]=t[f],t[f]=n,i>=f?r=o:f>=i&&(e=f-1)}return 0},t}()}(window),function(t){"use strict";var r=t.Igata,e=r,n=function(){function t(){throw new Error("MatrixMath can't create instance.")}var r=t.prototype;return r.constructor=t,t.identity=function(t,r){"undefined"==typeof r&&(r=1);for(var e=t.data,n=t.rows,a=t.cols,o=a+1|0,f=n*a,i=f;--f>=0;)e[f]=0;for(f=i,i=0;f>i;)e[i]=r,i+=o},t.transpose=function(t,r){for(var e=0,n=0,a=r.rows,o=r.cols,f=0,i=0,u=0,s=r.data,c=t.data;a>e;i+=1,f+=o,e++)for(u=i,n=0;o>n;u+=a,n++)c[u]=s[f+n]},t.multiply=function(t,r,e){for(var n=0,a=0,o=0,f=0,i=0,u=0,s=0,c=0,d=r.cols,h=r.rows,l=e.cols,p=r.data,v=e.data,g=t.data,y=0;h>n;f+=d,n++)for(s=0,a=0;l>a;c++,s++,a++){for(u=s,i=f,y=0,o=0;d>o;i++,u+=l,o++)y+=p[i]*v[u];g[c]=y}},t.multiply_ABt=function(t,r,e){for(var n=0,a=0,o=0,f=0,i=0,u=0,s=0,c=r.cols,d=r.rows,h=e.rows,l=r.data,p=e.data,v=t.data,g=0;d>n;f+=c,n++)for(u=0,a=0;h>a;s++,a++){for(i=f,g=0,o=0;c>o;i++,u++,o++)g+=l[i]*p[u];v[s]=g}},t.multiply_AtB=function(t,r,e){for(var n=0,a=0,o=0,f=0,i=0,u=0,s=0,c=0,d=r.cols,h=r.rows,l=e.cols,p=r.data,v=e.data,g=t.data,y=0;d>n;f++,n++)for(s=0,a=0;l>a;c++,s++,a++){for(u=s,i=f,y=0,o=0;h>o;i+=d,u+=l,o++)y+=p[i]*v[u];g[c]=y}},t.multiply_AAt=function(t,r){for(var e=0,n=0,a=0,o=0,f=0,i=0,u=0,s=0,c=0,d=r.cols,h=r.rows,l=r.data,p=t.data,v=0;h>e;o+=h+1,f=i,e++)for(s=o,c=o,u=f,n=e;h>n;s++,c+=h,n++){for(i=f,v=0,a=0;d>a;a++)v+=l[i++]*l[u++];p[s]=v,p[c]=v}},t.multiply_AtA=function(t,r){for(var e=0,n=0,a=0,o=0,f=0,i=0,u=0,s=0,c=0,d=r.cols,h=r.rows,l=r.data,p=t.data,v=0;d>e;u+=d,e++)for(o=e,c=u+e,s=c,n=e;d>n;s++,c+=d,n++){for(f=o,i=n,v=0,a=0;h>a;f+=d,i+=d,a++)v+=l[f]*l[i];p[s]=v,p[c]=v}},t.identity_3x3=function(t,r){"undefined"==typeof r&&(r=1);var e=t.data;e[0]=e[4]=e[8]=r,e[1]=e[2]=e[3]=0,e[5]=e[6]=e[7]=0},t.invert_3x3=function(t,r){var e=t.data,n=r.data,a=e[4],o=e[8],f=e[5],i=e[7],u=e[0],s=u*a,c=u*f,d=e[3],h=e[1],l=d*h,p=e[2],v=d*p,g=e[6],y=g*h,w=g*p,_=1/(s*o-c*i-l*o+v*i+y*f-w*a);n[0]=(a*o-f*i)*_,n[1]=-(h*o-p*i)*_,n[2]=-(-h*f+p*a)*_,n[3]=-(d*o-f*g)*_,n[4]=(u*o-w)*_,n[5]=-(c-v)*_,n[6]=-(-d*i+a*g)*_,n[7]=-(u*i-y)*_,n[8]=(s-l)*_},t.multiply_3x3=function(t,r,e){var n=t.data,a=r.data,o=e.data,f=a[0],i=a[1],u=a[2],s=a[3],c=a[4],d=a[5],h=a[6],l=a[7],p=a[8],v=o[0],g=o[1],y=o[2],w=o[3],_=o[4],x=o[5],b=o[6],m=o[7],B=o[8];n[0]=f*v+i*w+u*b,n[1]=f*g+i*_+u*m,n[2]=f*y+i*x+u*B,n[3]=s*v+c*w+d*b,n[4]=s*g+c*_+d*m,n[5]=s*y+c*x+d*B,n[6]=h*v+l*w+p*b,n[7]=h*g+l*_+p*m,n[8]=h*y+l*x+p*B},t.mat3x3_determinant=function(t){var r=t.data;return r[0]*r[4]*r[8]-r[0]*r[5]*r[7]-r[3]*r[1]*r[8]+r[3]*r[2]*r[7]+r[6]*r[1]*r[5]-r[6]*r[2]*r[4]},t.determinant_3x3=function(t,r,e,n,a,o,f,i,u){return t*a*u-t*o*i-n*r*u+n*e*i+f*r*o-f*e*a},t}();e.MatrixMath=n,e.MM=n}(window),function(t){"use strict";var r=t.Igata,e=r,n=function(){function t(t,r,e,n){n=t[r],t[r]=t[e],t[e]=n}function n(t,r){return t=c(t),r=c(r),t>r?(r/=t,t*d(1+r*r)):r>0?(t/=r,r*d(1+t*t)):0}function a(e,a,o,f,u,s){var d=r.EPSILON,h=0,l=0,p=0,v=0,g=0,y=0,w=0,_=0,x=0,b=s*s*30,m=0,B=0,k=0,M=0,I=0,z=0,A=0,C=0,D=0,S=i.getBuffer(s<<2),O=i.getBuffer(s<<2),R=S.i32,E=O.i32;if(f)for(;s>h;h++){for(p=h*u,l=0;s>l;l++)f[p+l]=0;f[p+h]=1}for(p=0;s>p;p++){if(o[p]=e[(a+1)*p],s-1>p){for(v=p+1,m=c(e[a*p+v]),h=p+2;s>h;h++)B=c(e[a*p+h]),B>m&&(m=B,v=h);R[p]=v}if(p>0){for(v=0,m=c(e[p]),h=1;p>h;h++)B=c(e[a*h+p]),B>m&&(m=B,v=h);E[p]=v}}if(s>1)for(;b>x;x++){for(p=0,m=c(e[R[0]]),h=1;s-1>h;h++)B=c(e[a*h+R[h]]),B>m&&(m=B,p=h);for(g=R[p],h=1;s>h;h++)B=c(e[a*E[h]+h]),B>m&&(m=B,p=E[h],g=h);if(k=e[a*p+g],c(k)<=d)break;for(M=.5*(o[g]-o[p]),I=c(M)+n(k,M),z=n(k,I),A=I/z,z=k/z,I=k/I*k,0>M&&(z=-z,I=-I),e[a*p+g]=0,o[p]-=I,o[g]+=I,h=0;p>h;h++)w=a*h+p,_=a*h+g,C=e[w],D=e[_],e[w]=C*A-D*z,e[_]=C*z+D*A;for(h=p+1;g>h;h++)w=a*p+h,_=a*h+g,C=e[w],D=e[_],e[w]=C*A-D*z,e[_]=C*z+D*A;for(h=g+1,w=a*p+h,_=a*g+h;s>h;h++,w++,_++)C=e[w],D=e[_],e[w]=C*A-D*z,e[_]=C*z+D*A;if(f)for(w=u*p,_=u*g,h=0;s>h;h++,w++,_++)C=f[w],D=f[_],f[w]=C*A-D*z,f[_]=C*z+D*A;for(l=0;2>l;l++){if(y=0===l?p:g,s-1>y){for(v=y+1,m=c(e[a*y+v]),h=y+2;s>h;h++)B=c(e[a*y+h]),B>m&&(m=B,v=h);R[y]=v}if(y>0){for(v=0,m=c(e[y]),h=1;y>h;h++)B=c(e[a*h+y]),B>m&&(m=B,v=h);E[y]=v}}}for(p=0;s-1>p;p++){for(v=p,h=p+1;s>h;h++)o[v]<o[h]&&(v=h);if(p!==v&&(t(o,v,p,m),f))for(h=0;s>h;h++)t(f,u*v+h,u*p+h,m)}i.putBuffer(S),i.putBuffer(O)}function o(e,a,o,f,u,s,l,p){for(var v=2*r.EPSILON,g=r.FLT_MIN,y=0,w=0,_=0,x=0,b=h(s,30),m=0,B=0,k=0,M=0,I=0,z=0,A=0,C=0,D=0,S=0,O=0,R=0,E=0,U=0,F=0,L=0,T=0,G=4660,P=0,N=0,V=0,q=i.getBuffer(l<<3),Y=q.f64;l>y;y++){for(_=0,O=0;s>_;_++)C=e[y*a+_],O+=C*C;if(Y[y]=O,f){for(_=0;l>_;_++)f[y*u+_]=0;f[y*u+y]=1}}for(;b>x;x++){for(I=0,y=0;l-1>y;y++)for(w=y+1;l>w;w++){for(m=y*a|0,B=w*a|0,F=Y[y],L=0,T=Y[w],_=2,L+=e[m]*e[B],L+=e[m+1]*e[B+1];s>_;_++)L+=e[m+_]*e[B+_];if(!(c(L)<=v*d(F*T))){for(L*=2,R=F-T,E=n(L,R),0>R?(U=.5*(E-R),A=d(U/E),z=L/(E*A*2)):(z=d((E+R)/(2*E)),A=L/(E*z*2)),F=0,T=0,_=2,D=z*e[m]+A*e[B],S=-A*e[m]+z*e[B],e[m]=D,e[B]=S,F+=D*D,T+=S*S,D=z*e[m+1]+A*e[B+1],S=-A*e[m+1]+z*e[B+1],e[m+1]=D,e[B+1]=S,F+=D*D,T+=S*S;s>_;_++)D=z*e[m+_]+A*e[B+_],S=-A*e[m+_]+z*e[B+_],e[m+_]=D,e[B+_]=S,F+=D*D,T+=S*S;if(Y[y]=F,Y[w]=T,I=1,f)for(k=y*u|0,M=w*u|0,_=2,D=z*f[k]+A*f[M],S=-A*f[k]+z*f[M],f[k]=D,f[M]=S,D=z*f[k+1]+A*f[M+1],S=-A*f[k+1]+z*f[M+1],f[k+1]=D,f[M+1]=S;l>_;_++)D=z*f[k+_]+A*f[M+_],S=-A*f[k+_]+z*f[M+_],f[k+_]=D,f[M+_]=S}}if(0===I)break}for(y=0;l>y;y++){for(_=0,O=0;s>_;_++)C=e[y*a+_],O+=C*C;Y[y]=d(O)}for(y=0;l-1>y;y++){for(w=y,_=y+1;l>_;_++)Y[w]<Y[_]&&(w=_);if(y!==w&&(t(Y,y,w,O),f)){for(_=0;s>_;_++)t(e,y*a+_,w*a+_,C);for(_=0;l>_;_++)t(f,y*u+_,w*u+_,C)}}for(y=0;l>y;y++)o[y]=Y[y];if(!f)return void i.putBuffer(q);for(y=0;p>y;y++){for(O=l>y?Y[y]:0;g>=O;){for(N=1/s,_=0;s>_;_++)G=214013*G+2531011,P=0!==(G>>16&32767&256)?N:-N,e[y*a+_]=P;for(x=0;2>x;x++)for(w=0;y>w;w++){for(O=0,_=0;s>_;_++)O+=e[y*a+_]*e[w*a+_];for(V=0,_=0;s>_;_++)C=e[y*a+_]-O*e[w*a+_],e[y*a+_]=C,V+=c(C);for(V=V?1/V:0,_=0;s>_;_++)e[y*a+_]*=V}for(O=0,_=0;s>_;_++)C=e[y*a+_],O+=C*C;O=d(O)}for(A=1/O,_=0;s>_;_++)e[y*a+_]*=A}i.putBuffer(q)}function f(){throw new Error("LinearAlgebra can't create instance.")}var i=e.Cache,u=e.Matrix_t,s=e.MM,c=e._abs,d=e._sqrt,h=e._max,l=f.prototype;return l.constructor=f,f.lu_solve=function(e,n){var a,o,f,i,u=0,s=0,d=0,h=1,l=e.cols,p=e.data,v=n.data;for(u=0;l>u;u++){for(d=u,s=u+1;l>s;s++)Math.abs(p[s*l+u])>Math.abs(p[d*l+u])&&(d=s);if(c(p[d*l+u])<r.EPSILON)return 0;if(d!==u){for(s=u;l>s;s++)t(p,u*l+s,d*l+s,a);t(v,u,d,a),h=-h}for(f=-1/p[u*l+u],s=u+1;l>s;s++){for(o=p[s*l+u]*f,d=u+1;l>d;d++)p[s*l+d]+=o*p[u*l+d];v[s]+=o*v[u]}p[u*l+u]=-f}for(u=l-1;u>=0;u--){for(i=v[u],d=u+1;l>d;d++)i-=p[u*l+d]*v[d];v[u]=i*p[u*l+u]}return 1},f.cholesky_solve=function(t,r){var e,n,a=0,o=0,f=0,i=0,u=0,s=0,c=0,d=t.cols,h=t.data,l=r.data;for(a=0;d>a;a++)for(n=1,i=a*d,u=i,o=a;d>o;o++){for(e=h[u+a],f=0;a>f;f++)e-=h[f*d+a]*h[u+f];if(o===a){if(h[u+a]=e,0===e)return 0;n=1/e}else h[i+o]=e,h[u+a]=e*n;u+=d}for(i=0,s=0;d>s;s++){for(e=l[s],c=0;s>c;c++)e-=h[i+c]*l[c];l[s]=e,i+=d}for(i=0,s=0;d>s;s++)l[s]/=h[i+s],i+=d;for(s=d-1;s>=0;s--){for(e=l[s],c=s+1,i=c*d;d>c;c++)e-=h[i+s]*l[c],i+=d;l[s]=e}return 1},f.svd_decompose=function(t,e,n,a,f){"undefined"==typeof f&&(f=0);var c=0,d=0,h=t.rows,l=t.cols,p=h,v=l,g=t.type|r.C1_t;v>p&&(c=1,d=p,p=v,v=d);var y=i.getBuffer(p*p<<3),w=i.getBuffer(v<<3),_=i.getBuffer(v*v<<3),x=new u(p,p,g,y.data),b=new u(1,v,g,w.data),m=new u(v,v,g,_.data);if(0===c)s.transpose(x,t);else{for(d=0;l*h>d;d++)x.data[d]=t.data[d];for(;v*p>d;d++)x.data[d]=0}if(o(x.data,p,b.data,m.data,v,p,v,p),e){for(d=0;v>d;d++)e.data[d]=b.data[d];for(;l>d;d++)e.data[d]=0}if(0===c){if(n&&f&r.SVD_U_T)for(d=p*p;--d>=0;)n.data[d]=x.data[d];else n&&s.transpose(n,x);if(a&&f&r.SVD_V_T)for(d=v*v;--d>=0;)a.data[d]=m.data[d];else a&&s.transpose(a,m)}else{if(n&&f&r.SVD_U_T)for(d=v*v;--d>=0;)n.data[d]=m.data[d];else n&&s.transpose(n,m);if(a&&f&r.SVD_V_T)for(d=p*p;--d>=0;)a.data[d]=x.data[d];else a&&s.transpose(a,x)}i.putBuffer(y),i.putBuffer(w),i.putBuffer(_)},f.svd_solve=function(t,e,n){var a=0,o=0,s=0,c=0,d=0,h=t.rows,l=t.cols,p=0,v=0,g=0,y=t.type|r.C1_t,w=i.getBuffer(h*h<<3),_=i.getBuffer(l<<3),x=i.getBuffer(l*l<<3),b=new u(h,h,y,w.data),m=new u(1,l,y,_.data),B=new u(l,l,y,x.data),k=n.data,M=b.data,I=m.data,z=B.data;for(f.svd_decompose(t,m,b,B,0),g=r.EPSILON*I[0]*l;l>a;a++,d+=l){for(v=0,o=0;l>o;o++)if(I[o]>g){for(s=0,p=0,c=0;h>s;s++,c+=l)p+=M[c+o]*k[s];v+=p*z[d+o]/I[o]}e.data[a]=v}i.putBuffer(w),i.putBuffer(_),i.putBuffer(x)},f.svd_invert=function(t,e){var n=0,a=0,o=0,s=0,c=0,d=0,h=e.rows,l=e.cols,p=0,v=0,g=e.type|r.C1_t,y=i.getBuffer(h*h<<3),w=i.getBuffer(l<<3),_=i.getBuffer(l*l<<3),x=new u(h,h,g,y.data),b=new u(1,l,g,w.data),m=new u(l,l,g,_.data),B=t.data,k=x.data,M=b.data,I=m.data;for(f.svd_decompose(e,b,x,m,0),v=r.EPSILON*M[0]*l;l>n;n++,c+=l)for(a=0,s=0;h>a;a++,d++){for(o=0,p=0;l>o;o++,s++)M[o]>v&&(p+=I[c+o]*k[s]/M[o]);B[d]=p}i.putBuffer(y),i.putBuffer(w),i.putBuffer(_)},f.eigenVV=function(t,e,n){for(var o=t.cols,f=o*o,s=t.type|r.C1_t,c=i.getBuffer(o*o<<3),d=i.getBuffer(o<<3),h=new u(o,o,s,c.data),l=new u(1,o,s,d.data);--f>=0;)h.data[f]=t.data[f];if(a(h.data,o,l.data,e?e.data:null,o,o),n)for(;--o>=0;)n.data[o]=l.data[o];i.putBuffer(c),i.putBuffer(d)},f}();e.LinearAlgebra=n,e.LA=n}(window),function(t){"use strict";var r=t.Igata,e=r,n=e.Cache,a=e.Matrix_t,o=e.MM,f=e.LA,i=e.Calc,u=e.F32_t,s=e.C1_t,c=e.EPSILON,d=e._sqrt,h=e._abs,l=e._log,p=e._pow,v=e._round,g=e._max,y=new a(3,3,u|s),w=new a(3,3,u|s),_=new a(6,6,u|s),x=new a(6,1,u|s),b=new a(9,9,u|s),m=new a(9,9,u|s),B=function(){function t(t,r,e,n,a){for(var o=0,f=0,i=0,u=0,s=0,c=0,h=0,l=0,p=0,v=0,g=0;a>o;++o)f+=t[o].x,i+=t[o].y,c+=r[o].x,h+=r[o].y;for(f/=a,i/=a,c/=a,h/=a,o=0;a>o;++o)v=t[o].x-f,g=t[o].y-i,u+=d(v*v+g*g),v=r[o].x-c,g=r[o].y-h,l+=d(v*v+g*g);u/=a,l/=a,s=Math.SQRT2/u,p=Math.SQRT2/l,e[0]=e[4]=s,e[2]=-f*s,e[5]=-i*s,e[1]=e[3]=e[6]=e[7]=0,e[8]=1,n[0]=n[4]=p,n[2]=-c*p,n[5]=-h*p,n[1]=n[3]=n[6]=n[7]=0,n[8]=1}function r(){}var e=r.prototype;return e.constructor=r,e.run=function(r,e,i,u){var c,d,h=0,l=0,p=i.type|s,v=i.data,g=y.data,b=w.data,m=0,B=0;t(r,e,g,b,u);for(var k=n.getBuffer(2*u*6<<3),M=n.getBuffer(2*u<<3),I=new a(6,2*u,p,k.data),z=new a(1,2*u,p,M.data),A=I.data,C=z.data;u>h;++h)c=r[h],d=e[h],m=g[0]*c.x+g[1]*c.y+g[2],B=g[3]*c.x+g[4]*c.y+g[5],l=2*h*6,A[l]=m,A[l+1]=B,A[l+2]=1,A[l+3]=0,A[l+4]=0,A[l+5]=0,l+=6,A[l]=0,A[l+1]=0,A[l+2]=0,A[l+3]=m,A[l+4]=B,A[l+5]=1,C[h<<1]=b[0]*d.x+b[1]*d.y+b[2],C[(h<<1)+1]=b[3]*d.x+b[4]*d.y+b[5];return o.multiply_AtA(_,I),o.multiply_AtB(x,I,z),f.lu_solve(_,x),v[0]=x.data[0],v[1]=x.data[1],v[2]=x.data[2],v[3]=x.data[3],v[4]=x.data[4],v[5]=x.data[5],v[6]=0,v[7]=0,v[8]=1,o.invert_3x3(w,w),o.multiply_3x3(i,w,i),o.multiply_3x3(i,i,y),n.putBuffer(k),n.putBuffer(M),1},r}(),k=function(){function t(){}var r=t.prototype;return r.constructor=t,r.run=function(t,r,e,n){for(var a=0,i=0,u=e.data,s=y.data,d=w.data,l=b.data,p=m.data,v=0,g=0,_=0,x=0,B=0,k=0,M=0,I=0,z=0,A=0,C=0,D=0;n>a;++a)M+=r[a].x,I+=r[a].y,C+=t[a].x,D+=t[a].y;for(M/=n,I/=n,C/=n,D/=n,a=0;n>a;++a)B+=h(r[a].x-M),k+=h(r[a].y-I),z+=h(t[a].x-C),A+=h(t[a].y-D);if(h(B)<c||h(k)<c||h(z)<c||h(A)<c)return 0;for(B=n/B,k=n/k,z=n/z,A=n/A,s[0]=z,s[1]=0,s[2]=-C*z,s[3]=0,s[4]=A,s[5]=-D*A,s[6]=0,s[7]=0,s[8]=1,d[0]=1/B,d[1]=0,d[2]=M,d[3]=0,d[4]=1/k,d[5]=I,d[6]=0,d[7]=0,d[8]=1,a=81;--a>=0;)l[a]=0;for(a=0;n>a;++a)v=(r[a].x-M)*B,g=(r[a].y-I)*k,_=(t[a].x-C)*z,x=(t[a].y-D)*A,l[0]+=_*_,l[1]+=_*x,l[2]+=_,l[6]+=_*-v*_,l[7]+=_*-v*x,l[8]+=_*-v,l[10]+=x*x,l[11]+=x,l[15]+=x*-v*_,l[16]+=x*-v*x,l[17]+=x*-v,l[20]+=1,l[24]+=-v*_,l[25]+=-v*x,l[26]+=-v,l[30]+=_*_,l[31]+=_*x,l[32]+=_,l[33]+=_*-g*_,l[34]+=_*-g*x,l[35]+=_*-g,l[40]+=x*x,l[41]+=x,l[42]+=x*-g*_,l[43]+=x*-g*x,l[44]+=x*-g,l[50]+=1,l[51]+=-g*_,l[52]+=-g*x,l[53]+=-g,l[60]+=-v*_*-v*_+-g*_*-g*_,l[61]+=-v*_*-v*x+-g*_*-g*x,l[62]+=-v*_*-v+-g*_*-g,l[70]+=-v*x*-v*x+-g*x*-g*x,l[71]+=-v*x*-v+-g*x*-g,l[80]+=-v*-v+-g*-g;for(a=0;9>a;++a)for(i=0;a>i;++i)l[9*a+i]=l[9*i+a];return f.eigenVV(b,m),u[0]=p[72],u[1]=p[73],u[2]=p[74],u[3]=p[75],u[4]=p[76],u[5]=p[77],u[6]=p[78],u[7]=p[79],u[8]=p[80],o.multiply_3x3(e,w,e),o.multiply_3x3(e,e,y),v=1/u[8],u[0]*=v,u[1]*=v,u[2]*=v,u[3]*=v,u[4]*=v,u[5]*=v,u[6]*=v,u[7]*=v,u[8]=1,1},r.error=function(t,r,e,n,a){for(var o,f,i=0,u=0,s=0,c=0,d=e.data;a>i;++i)o=t[i],f=r[i],u=1/(d[6]*o.x+d[7]*o.y+1),s=(d[0]*o.x+d[1]*o.y+d[2])*u-f.x,c=(d[3]*o.x+d[4]*o.y+d[5])*u-f.y,n[i]=s*s+c*c;
},r.checkSubset=function(t,r,e){if(4===e){var n=0,a=t[0],f=t[1],i=t[2],u=t[3],s=r[0],c=r[1],d=r[2],h=r[3],l=a.x,p=a.y,v=1,g=f.x,y=f.y,w=1,_=i.x,x=i.y,b=1,m=s.x,B=s.y,k=1,M=c.x,I=c.y,z=1,A=d.x,C=d.y,D=1,S=o.determinant_3x3(l,p,v,g,y,w,_,x,b),O=o.determinant_3x3(m,B,k,M,I,z,A,C,D);if(0>S*O&&n++,l=f.x,p=f.y,g=i.x,y=i.y,_=u.x,x=u.y,m=c.x,B=c.y,M=d.x,I=d.y,A=h.x,C=h.y,S=o.determinant_3x3(l,p,v,g,y,w,_,x,b),O=o.determinant_3x3(m,B,k,M,I,z,A,C,D),0>S*O&&n++,l=a.x,p=a.y,g=i.x,y=i.y,_=u.x,x=u.y,m=s.x,B=s.y,M=d.x,I=d.y,A=h.x,C=h.y,S=o.determinant_3x3(l,p,v,g,y,w,_,x,b),O=o.determinant_3x3(m,B,k,M,I,z,A,C,D),0>S*O&&n++,l=a.x,p=a.y,g=f.x,y=f.y,_=u.x,x=u.y,m=s.x,B=s.y,M=c.x,I=c.y,A=h.x,C=h.y,S=o.determinant_3x3(l,p,v,g,y,w,_,x,b),O=o.determinant_3x3(m,B,k,M,I,z,A,C,D),0>S*O&&n++,0!==n&&-4!==n)return!1}return!0},r.check_subset=function(t,r,e){this.checkSubset(t,r,e)},t}(),M=function(){function t(t,r,e,n){"undefined"==typeof t&&(t=0),"undefined"==typeof r&&(r=.5),"undefined"==typeof e&&(e=.5),"undefined"==typeof n&&(n=.99),this.size=t,this.thresh=r,this.eps=e,this.prob=n}var r=t.prototype;return r.constructor=t,r.update=function(t,r){var e=l(1-this.prob),n=l(1-p(1-t,this.size));return 0|(n>=0||-e>=r*-n?r:v(e/n))},r.update_iters=function(t,r){return this.update(t,r)},t}(),I=function(){function t(t,r,e,n,a,o,f){for(var i=1e3,u=[],s=0,c=0,d=0,h=0,l=!1;i>d;++d){for(s=0;n>s&&i>d;){for(l=!1,h=0;!l;)for(l=!0,h=u[s]=0|Math.floor(Math.random()*a),c=0;s>c;++c)if(h===u[c]){l=!1;break}o[s]=r[h],f[s]=e[h],t.check_subset(o,f,s+1)?++s:d++}break}return s===n&&i>d}function e(t,r,e,n,a,o,f,i){var u=0,s=0,c=0,d=o*o;for(t.error(e,n,r,f,a);a>s;++s)c=f[s]<=d,i[s]=c,u+=c;return u}function o(){throw new Error("MotionEstimator can't create instance.")}var f=o.prototype;return f.constructor=o,o.ransac=function(o,f,i,u,c,d,h,l){if("undefined"==typeof l&&(l=1e3),c<o.size)return!1;var p=o.size,v=l,y=0,w=!1,_=[],x=[],b=!1,m=d.cols,B=d.rows,k=d.type|s,M=n.getBuffer(m*B<<3),I=n.getBuffer(c),z=n.getBuffer(c<<2),A=new a(m,B,k,M.data),C=new a(c,1,r.U8C1_t,I.data),D=-1,S=0,O=0,R=z.f32;if(c===p){if(f.run(i,u,A,c)<=0)return n.getBuffer(M),n.getBuffer(I),n.getBuffer(z),!1;if(A.copy_to(d),h)for(;--c>=0;)h.data[c]=1;return n.putBuffer(M),n.putBuffer(I),n.putBuffer(z),!0}for(;v>y;++y){if(b=t(f,i,u,p,c,_,x),!b){if(0===y)return n.putBuffer(M),n.putBuffer(I),n.putBuffer(z),!1;break}O=f.run(_,x,A,p),0>=O||(S=e(f,A,i,u,c,o.thresh,R,C.data),S>g(D,p-1)&&(A.copy_to(d),D=S,h&&C.copy_to(h),v=o.update((c-S)/c,v),w=!0))}return n.putBuffer(M),n.putBuffer(I),n.putBuffer(z),w},o.lmeds=function(o,f,u,c,h,l,p,v){if("undefined"==typeof v&&(v=1e3),h<o.size)return!1;var y=o.size,w=v,_=0,x=!1,b=[],m=[],B=!1,k=l.cols,M=l.rows,I=l.type|s,z=n.getBuffer(k*M<<3),A=n.getBuffer(h),C=n.getBuffer(h<<2),D=new a(k,M,I,z.data),S=new a(h,1,r.U8_t|s,A.data),O=0,R=0,E=C.f32,U=1e9,F=0,L=0;if(o.eps=.45,w=o.update_iters(o.eps,w),h===y){if(f.run(u,c,D,h)<=0)return n.putBuffer(z),n.putBuffer(A),n.putBuffer(C),!1;if(D.copy_to(l),p)for(;--h>=0;)p.data[h]=1;return n.putBuffer(z),n.putBuffer(A),n.putBuffer(C),!0}for(;w>_;++_){if(B=t(f,u,c,y,h,b,m),!B){if(0===_)return n.putBuffer(z),n.putBuffer(A),n.putBuffer(C),!1;break}R=f.run(b,m,D,y),0>=R||(f.error(u,c,D,E,h),L=i.median(E,0,h-1),U>L&&(U=L,D.copy(l),x=!0))}return x&&(F=2.5*1.4826*(1+5/(h-y))*d(U),F=g(F,.001),O=e(f,l,u,c,h,F,E,S.data),p&&S.copy(p),x=O>=y),n.putBuffer(z),n.putBuffer(A),n.putBuffer(C),x},o}();e.Affine2d=B,e.HomoGraphy2d=k,e.Ransac_t=M,e.MotionEstimator=I,e.Estimator=I}(window),function(t){"use strict";function r(t,r,e,n){for(var a=0,o=t.channel,f=t.cols,u=t.rows,s=t.data,c=r.data,d=f/e,h=u/n,l=d*h*65536|0,p=0,v=0,g=0,_=0,x=0,b=0,m=0,B=0,k=0,M=0,I=0,z=0,A=0,C=0,D=0,S=0,O=i.getBuffer(e*o<<2),R=i.getBuffer(e*o<<2),E=i.getBuffer(2*f*3<<2),U=O.i32,F=R.i32,L=E.i32;e>p;p++){for(k=p*d,M=k+d,x=k+1-1e-6|0,b=0|M,x=w(x,f-1),b=w(b,f-1),x>k&&(L[B++]=p*o|0,L[B++]=(x-1)*o|0,L[B++]=256*(x-k)|0,a++),g=x;b>g;g++)a++,L[B++]=p*o|0,L[B++]=g*o|0,L[B++]=256;M-b>.001&&(a++,L[B++]=p*o|0,L[B++]=b*o|0,L[B++]=256*(M-b)|0)}for(p=0;e*o>p;p++)U[p]=F[p]=0;for(v=0,_=0;u>_;_++){for(I=f*_,B=0;a>B;B++)for(A=L[3*B],x=L[3*B+1],C=L[3*B+2],m=0;o>m;m++)U[A+m]+=s[I+x+m]*C;if(_+1>=(v+1)*h||_===u-1){if(D=256*Math.max(_+1-(v+1)*h,0)|0,S=256-D,z=e*v,0>=D)for(p=0;e*o>p;p++)c[z+p]=w(y((F[p]+256*U[p])/l,0),255),F[p]=U[p]=0;else for(p=0;e*o>p;p++)c[z+p]=w(y((F[p]+U[p]*S)/l,0),255),F[p]=U[p]*D,U[p]=0;v++}else for(p=0;e*o>p;p++)F[p]+=256*U[p],U[p]=0}i.putBuffer(R),i.putBuffer(O),i.putBuffer(E)}function e(t,r,e,n){for(var a=0,o=t.channel,f=t.cols,u=t.rows,s=t.data,c=r.data,d=f/e,h=u/n,l=1/(d*h),p=0,v=0,g=0,y=0,w=0,_=0,x=0,b=0,m=0,B=0,k=0,M=0,I=0,z=0,A=0,C=0,D=i.getBuffer(e*o<<2),S=i.getBuffer(e*o<<2),O=i.getBuffer(2*f*3<<2),R=D.f32,E=S.f32,U=O.f32;e>p;p++){for(m=p*d,B=m+d,w=m+1-1e-6|0,_=0|B,w=Math.min(w,f-1),_=Math.min(_,f-1),w>m&&(a++,U[b++]=(w-1)*o|0,U[b++]=p*o|0,U[b++]=(w-m)*l),g=w;_>g;g++)a++,U[b++]=g*o|0,U[b++]=p*o|0,U[b++]=l;B-_>.001&&(a++,U[b++]=_*o|0,U[b++]=p*o|0,U[b++]=(B-_)*l)}for(p=0;e*o>p;p++)R[p]=E[p]=0;for(v=0,y=0;u>y;y++){for(k=f*y,b=0;a>b;b++)for(w=0|U[3*b],I=0|U[3*b+1],z=U[3*b+2],x=0;o>x;x++)R[I+x]+=s[k+w+x]*z;if(y+1>=(v+1)*h||y===u-1){if(A=Math.max(y+1-(v+1)*h,0),C=1-A,M=e*v,Math.abs(A)<.001)for(p=0;e*o>p;p++)c[M+p]=E[p]+R[p],E[p]=R[p]=0;else for(p=0;e*o>p;p++)c[M+p]=E[p]+R[p]*C,E[p]=R[p]*A,R[p]=0;v++}else for(p=0;e*o>p;p++)E[p]+=R[p],R[p]=0}i.putBuffer(S),i.putBuffer(D),i.putBuffer(O)}function n(t,r,e,n,a,o,f,i){for(var u=0,s=0,c=0,d=0,h=0,l=0,p=0,v=0,g=0,y=o[0],w=0,_=n<<1,x=3*n,b=n<<2;a>u;++u){for(l=r[d],s=0;i>s;++s)t[s]=l;for(s=0;n-2>=s;s+=2)t[s+i]=r[d+s],t[s+i+1]=r[d+s+1];for(;n>s;++s)t[s+i]=r[d+s];for(l=r[d+n-1],s=n;i+n>s;++s)t[s+i]=l;for(s=0;n-4>=s;s+=4){for(l=t[s]*y,p=t[s+1]*y,v=t[s+2]*y,g=t[s+3]*y,c=1;f>c;++c)w=o[c],l+=t[c+s]*w,p+=t[c+s+1]*w,v+=t[c+s+2]*w,g+=t[c+s+3]*w;e[h+s]=Math.min(l>>8,255),e[h+s+1]=Math.min(p>>8,255),e[h+s+2]=Math.min(v>>8,255),e[h+s+3]=Math.min(g>>8,255)}for(;n>s;++s){for(l=t[s]*y,c=1;f>c;++c)l+=t[c+s]*o[c];e[h+s]=Math.min(l>>8,255)}d+=n,h+=n}for(u=0;n>u;++u){for(l=e[u],s=0;i>s;++s)t[s]=l;for(c=u,s=0;a-2>=s;s+=2,c+=_)t[s+i]=e[c],t[s+i+1]=e[c+n];for(;a>s;++s,c+=n)t[s+i]=e[c];for(l=e[(a-1)*n+u],s=a;i+a>s;++s)t[s+i]=l;for(h=u,s=0;a-4>=s;s+=4,h+=b){for(l=t[s]*y,p=t[s+1]*y,v=t[s+2]*y,g=t[s+3]*y,c=1;f>c;++c)w=o[c],l+=t[c+s]*w,p+=t[c+s+1]*w,v+=t[c+s+2]*w,g+=t[c+s+3]*w;e[h]=Math.min(l>>8,255),e[h+n]=Math.min(p>>8,255),e[h+_]=Math.min(v>>8,255),e[h+x]=Math.min(g>>8,255)}for(;a>s;++s,h+=n){for(l=t[s]*y,c=1;f>c;++c)l+=t[c+s]*o[c];e[h]=Math.min(l>>8,255)}}}function a(t,r,e,n,a,o,f,i){for(var u=0,s=0,c=0,d=0,h=0,l=0,p=0,v=0,g=0,y=o[0],w=0,_=n<<1,x=3*n,b=n<<2;a>u;++u){for(l=r[d],s=0;i>s;++s)t[s]=l;for(s=0;n-2>=s;s+=2)t[s+i]=r[d+s],t[s+i+1]=r[d+s+1];for(;n>s;++s)t[s+i]=r[d+s];for(l=r[d+n-1],s=n;i+n>s;++s)t[s+i]=l;for(s=0;n-4>=s;s+=4){for(l=t[s]*y,p=t[s+1]*y,v=t[s+2]*y,g=t[s+3]*y,c=1;f>c;++c)w=o[c],l+=t[c+s]*w,p+=t[c+s+1]*w,v+=t[c+s+2]*w,g+=t[c+s+3]*w;e[h+s]=l,e[h+s+1]=p,e[h+s+2]=v,e[h+s+3]=g}for(;n>s;++s){for(l=t[s]*y,c=1;f>c;++c)l+=t[c+s]*o[c];e[h+s]=l}d+=n,h+=n}for(u=0;n>u;++u){for(l=e[u],s=0;i>s;++s)t[s]=l;for(c=u,s=0;a-2>=s;s+=2,c+=_)t[s+i]=e[c],t[s+i+1]=e[c+n];for(;a>s;++s,c+=n)t[s+i]=e[c];for(l=e[(a-1)*n+u],s=a;i+a>s;++s)t[s+i]=l;for(h=u,s=0;a-4>=s;s+=4,h+=b){for(l=t[s]*y,p=t[s+1]*y,v=t[s+2]*y,g=t[s+3]*y,c=1;f>c;++c)w=o[c],l+=t[c+s]*w,p+=t[c+s+1]*w,v+=t[c+s+2]*w,g+=t[c+s+3]*w;e[h]=l,e[h+n]=p,e[h+_]=v,e[h+x]=g}for(;a>s;++s,h+=n){for(l=t[s]*y,c=1;f>c;++c)l+=t[c+s]*o[c];e[h]=l}}}var o=t.Igata,f=o,i=f.Cache,u=f.Calc,s=f.Matrix_t,c=f.COLOR_RGBA2GRAY,d=f.COLOR_BGRA2GRAY,h=f.COLOR_BGR2GRAY,l=f.COLOR_RGB2GRAY,p=f.BOX_BLUR_NOSCALE,v=f.U8_t,g=f.S32_t,y=f._max,w=f._min,_=f._PI,x=f._sin,b=f._cos,m=f._floor,B=f._round,k=f._abs,M=function(){function t(){throw new Error("Processing can't create instance.")}var o=t.prototype;return o.constructor=t,t.grayscale=function(t,r,e,n,a){"undefined"==typeof a&&(a=c);var o=0,f=0,i=0,u=0,s=0,p=0,v=4899,g=9617,y=1868,w=4;(a===d||a===h)&&(v=1868,y=4899),(a===l||a===h)&&(w=3);var _=w<<1,x=3*w|0;n.resize(r,e,1);var b,m=n.data;for(f=0;e>f;++f,u+=r,i+=r*w){for(o=0,s=i,p=u,b=r-4;b>=o;o+=4,s+=w<<2,p+=4)m[p]=t[s]*v+t[s+1]*g+t[s+2]*y+8192>>14,m[p+1]=t[s+w]*v+t[s+w+1]*g+t[s+w+2]*y+8192>>14,m[p+2]=t[s+_]*v+t[s+_+1]*g+t[s+_+2]*y+8192>>14,m[p+3]=t[s+x]*v+t[s+x+1]*g+t[s+x+2]*y+8192>>14;for(;r>o;++o,++p,s+=w)m[p]=t[s]*v+t[s+1]*g+t[s+2]*y+8192>>14}},t.resample=function(t,n,a,o){var f=t.rows,i=t.cols;f>o&&i>a&&(n.resize(a,o,t.channel),t.type&v&&n.type&v&&256>f*i/(o*a)?r(t,n,a,o):e(t,n,a,o))},t.boxGray=function(t,r,e,n){"undefined"==typeof n&&(n=0);var a=t.cols,o=t.rows,f=o<<1,u=a<<1,s=0,c=0,d=0,h=0,l=(e<<1)+1|0,v=e+1|0,g=v+1|0,y=n&p?1:1/(l*l),w=i.getBuffer(a*o<<2),_=0,x=0,b=0,m=0,B=0,k=w.i32,M=t.data,I=0;for(r.resize(a,o,t.channel),d=0;o>d;++d){for(x=d,_=v*M[b],s=b+1|0,h=b+e|0;h>=s;++s)_+=M[s];for(m=b+v|0,B=b,I=M[B],c=0;e>c;++c,x+=o)k[x]=_,_+=M[m]-I,m++;for(;a-g>c;c+=2,x+=f)k[x]=_,_+=M[m]-M[B],k[x+o]=_,_+=M[m+1]-M[B+1],m+=2,B+=2;for(;a-v>c;++c,x+=o)k[x]=_,_+=M[m]-M[B],m++,B++;for(I=M[m-1];a>c;++c,x+=o)k[x]=_,_+=I-M[B],B++;b+=a}if(b=0,M=r.data,1===y)for(d=0;a>d;++d){for(x=d,_=v*k[b],s=b+1|0,h=b+e|0;h>=s;++s)_+=k[s];for(m=b+v,B=b,I=k[B],c=0;e>c;++c,x+=a)M[x]=_,_+=k[m]-I,m++;for(;o-g>c;c+=2,x+=u)M[x]=_,_+=k[m]-k[B],M[x+a]=_,_+=k[m+1]-k[B+1],m+=2,B+=2;for(;o-v>c;++c,x+=a)M[x]=_,_+=k[m]-k[B],m++,B++;for(I=k[m-1];o>c;++c,x+=a)M[x]=_,_+=I-k[B],B++;b+=o}else for(d=0;a>d;++d){for(x=d,_=v*k[b],s=b+1|0,h=b+e|0;h>=s;++s)_+=k[s];for(m=b+v,B=b,I=k[B],c=0;e>c;++c,x+=a)M[x]=_*y,_+=k[m]-I,m++;for(;o-g>c;c+=2,x+=u)M[x]=_*y,_+=k[m]-k[B],M[x+a]=_*y,_+=k[m+1]-k[B+1],m+=2,B+=2;for(;o-v>c;++c,x+=a)M[x]=_*y,_+=k[m]-k[B],m++,B++;for(I=k[m-1];o>c;++c,x+=a)M[x]=_*y,_+=I-k[B],B++;b+=o}i.putBuffer(w)},t.box_blur_gray=function(r,e,n,a){t.boxGray(r,e,n,a)},t.gaussian=function(t,r,e,o){"undefined"==typeof o&&(o=0),"undefined"==typeof e&&(e=0),e=0===e?2*Math.max(1,4*o+1-1e-8)+1|0:e;var f=e>>1,s=t.cols,c=t.rows,d=t.type,h=d&v;r.resize(s,c,t.channel);var l,p,y=t.data,w=r.data,_=e+Math.max(c,s)|0,x=i.getBuffer(_<<2),b=i.getBuffer(e<<2);h?(l=x.i32,p=b.i32):d&g?(l=x.i32,p=b.f32):(l=x.f32,p=b.f32),u.kernel(e,o,p,d),h?n(l,y,w,s,c,p,e,f):a(l,y,w,s,c,p,e,f),i.putBuffer(x),i.putBuffer(b)},t.gaussian_blur=function(r,e,n,a){t.gaussian(r,e,n,a)},t.transform=function(t,r,e,n){for(var a,o=t.data,f=t.cols,i=t.rows,u=f,s=0,c=_,d=B((c-s)/e),h=B((2*(f+i)+1)/r),l=1/r,p=new Int32Array((d+2)*(h+2)),v=new Float32Array(d),g=new Float32Array(d),y=0,k=s;d>y;y++)v[y]=x(k)*l,g[y]=b(k)*l,k+=e;var M;for(S=0;i>S;S++)for(M=0;f>M;M++)if(0!==o[S*u+M])for(y=0;d>y;y++)a=B(M*g[y]+S*v[y]),a+=(h-1)/2,p[(y+1)*(h+2)+a+1]+=1;var I,z=[];for(a=0;h>a;a++)for(y=0;d>y;y++)I=(y+1)*(h+2)+a+1,p[I]>n&&p[I]>p[I-1]&&p[I]>=p[I+1]&&p[I]>p[I-h-2]&&p[I]>=p[I+h+2]&&z.push(I);z.sort(function(t,r){return p[t]>p[r]||p[t]===p[r]&&r>t});var A,C,D,S,O=w(d*h,z.length),R=1/(h+2),E=[];for(S=0;O>S;S++)A=z[S],y=m(A*R)-1,a=A-(y+1)*(h+2)-1,C=(a-.5*(h-1))*r,D=y*e,E.push([C,D]);return E},t.hough_transform=function(r,e,n,a){return t.transform(r,e,n,a)},t.pyrdown=function(t,r,e,n){"undefined"==typeof e&&(e=0),"undefined"==typeof n&&(n=0);var a=t.cols,o=t.rows,f=a>>1,i=o>>1,u=f-(e<<1),s=i-(n<<1),c=0,d=0,h=e+n*a,l=0,p=0,v=0;r.resize(f,i,t.channel);var g=t.data,y=r.data;for(d=0;s>d;++d){for(l=h,v=p,c=0;u-2>=c;c+=2,v+=2,l+=4)y[v]=g[l]+g[l+1]+g[l+a]+g[l+a+1]+2>>2,y[v+1]=g[l+2]+g[l+3]+g[l+a+2]+g[l+a+3]+2>>2;for(;u>c;++c,++v,l+=2)y[v]=g[l]+g[l+1]+g[l+a]+g[l+a+1]+2>>2;h+=a<<1,p+=f}},t.scharrDerivatives=function(t,r){var e,n,a,o,f,u,s,c,d=t.cols,h=t.rows,l=d<<1,p=0,y=0,w=0,_=0,x=0,b=0,m=0;r.resize(d,h,2);var B=t.data,k=r.data,M=i.getBuffer(d+2<<2),I=i.getBuffer(d+2<<2);for(t.type&v||t.type&g?(s=M.i32,c=I.i32):(s=M.f32,c=I.f32);h>y;++y,x+=d){for(_=(y>0?y-1:1)*d|0,b=(h-1>y?y+1:h-2)*d|0,m=y*l|0,p=0,w=1;d-2>=p;p+=2,w+=2)e=B[_+p],n=B[b+p],s[w]=3*(e+n)+10*B[x+p],c[w]=n-e,e=B[_+p+1],n=B[b+p+1],s[w+1]=3*(e+n)+10*B[x+p+1],c[w+1]=n-e;for(;d>p;++p,++w)e=B[_+p],n=B[b+p],s[w]=3*(e+n)+10*B[x+p],c[w]=n-e;for(p=d+1|0,s[0]=s[1],s[p]=s[d],c[0]=c[1],c[p]=c[d],p=0;d-4>=p;p+=4)e=c[p+2],n=c[p+1],a=c[p+3],o=c[p+4],f=s[p+2],u=s[p+3],k[m++]=f-s[p],k[m++]=3*(e+c[p])+10*n,k[m++]=u-s[p+1],k[m++]=3*(a+n)+10*e,k[m++]=s[p+4]-f,k[m++]=3*(o+e)+10*a,k[m++]=s[p+5]-u,k[m++]=3*(c[p+5]+a)+10*o;for(;d>p;++p)k[m++]=s[p+2]-s[p],k[m++]=3*(c[p+2]+c[p])+10*c[p+1]}i.putBuffer(M),i.putBuffer(I)},t.scharr_derivatives=function(r,e){t.scharrDerivatives(r,e)},t.sobelDerivatives=function(t,r){var e,n,a,o,f,u,s,c,d=t.cols,h=t.rows,l=d<<1,p=0,y=0,w=0,_=0,x=0,b=0,m=0;r.resize(d,h,2);var B=t.data,k=r.data,M=i.getBuffer(d+2<<2),I=i.getBuffer(d+2<<2);for(t.type&v||t.type&g?(s=M.i32,c=I.i32):(s=M.f32,c=I.f32);h>y;++y,x+=d){for(_=(y>0?y-1:1)*d|0,b=(h-1>y?y+1:h-2)*d|0,m=y*l|0,p=0,w=1;d-2>=p;p+=2,w+=2)e=B[_+p],n=B[b+p],s[w]=e+n+2*B[x+p],c[w]=n-e,e=B[_+p+1],n=B[b+p+1],s[w+1]=e+n+2*B[x+p+1],c[w+1]=n-e;for(;d>p;++p,++w)e=B[_+p],n=B[b+p],s[w]=e+n+2*B[x+p],c[w]=n-e;for(p=d+1|0,s[0]=s[1],s[p]=s[d],c[0]=c[1],c[p]=c[d],p=0;d-4>=p;p+=4)e=c[p+2],n=c[p+1],a=c[p+3],o=c[p+4],f=s[p+2],u=s[p+3],k[m++]=f-s[p],k[m++]=e+c[p]+2*n,k[m++]=u-s[p+1],k[m++]=a+n+2*e,k[m++]=s[p+4]-f,k[m++]=o+e+2*a,k[m++]=s[p+5]-u,k[m++]=c[p+5]+a+2*o;for(;d>p;++p)k[m++]=s[p+2]-s[p],k[m++]=c[p+2]+c[p]+2*c[p+1]}i.putBuffer(M),i.putBuffer(I)},t.sobel_derivatives=function(r,e){t.sobelDerivatives(r,e)},t.integralImage=function(t,r,e,n){var a=0|t.cols,o=0|t.rows,f=t.data,i=a+1|0,u=0,s=0,c=0,d=0,h=0,l=0,p=0,v=0;if(r&&e){for(;i>h;++h)r[h]=0,e[h]=0;for(c=i+1|0,d=1,h=0,v=0;o>h;++h,++c,++d){for(u=s=0,l=0;a-2>=l;l+=2,v+=2,c+=2,d+=2)p=f[v],u+=p,s+=p*p,r[c]=r[d]+u,e[c]=e[d]+s,p=f[v+1],u+=p,s+=p*p,r[c+1]=r[d+1]+u,e[c+1]=e[d+1]+s;for(;a>l;++l,++v,++c,++d)p=f[v],u+=p,s+=p*p,r[c]=r[d]+u,e[c]=e[d]+s}}else if(r){for(;i>h;++h)r[h]=0;for(c=i+1|0,d=1,h=0,v=0;o>h;++h,++c,++d){for(u=0,l=0;a-2>=l;l+=2,v+=2,c+=2,d+=2)u+=f[v],r[c]=r[d]+u,u+=f[v+1],r[c+1]=r[d+1]+u;for(;a>l;++l,++v,++c,++d)u+=f[v],r[c]=r[d]+u}}else if(e){for(;i>h;++h)e[h]=0;for(c=i+1|0,d=1,h=0,v=0;o>h;++h,++c,++d){for(s=0,l=0;a-2>=l;l+=2,v+=2,c+=2,d+=2)p=f[v],s+=p*p,e[c]=e[d]+s,p=f[v+1],s+=p*p,e[c+1]=e[d+1]+s;for(;a>l;++l,++v,++c,++d)p=f[v],s+=p*p,e[c]=e[d]+s}}if(n){for(h=0;i>h;++h)n[h]=0;for(c=i+1|0,d=0,h=0,v=0;o>h;++h,++c,++d){for(l=0;a-2>=l;l+=2,v+=2,c+=2,d+=2)n[c]=f[v]+n[d],n[c+1]=f[v+1]+n[d+1];for(;a>l;++l,++v,++c,++d)n[c]=f[v]+n[d]}for(c=i+a|0,d=a,h=0;o>h;++h,c+=i,d+=i)n[c]+=n[d];for(l=a-1;l>0;--l)for(c=l+o*i,d=c-i,h=o;h>0;--h,c-=i,d-=i)n[c]+=n[d]+n[d+1]}},t.compute_integral_image=function(r,e,n,a){t.integralImage(r,e,n,a)},t.histogram=function(t,r){var e=t.cols,n=t.rows,a=t.data;r.resize(e,n,t.channel);var o,f,u=r.data,s=e*n,c=0,d=0,h=i.getBuffer(1024);for(o=h.i32;256>c;++c)o[c]=0;for(c=0;s>c;++c)++o[a[c]];for(d=o[0],c=1;256>c;++c)d=o[c]+=d;for(f=255/s,c=0;s>c;++c)u[c]=o[a[c]]*f+.5|0;i.putBuffer(h)},t.equalize_histogram=function(r,e){t.histogram(r,e)},t.canny=function(r,e,n,a){var o=r.cols,u=r.rows;r.data;e.resize(o,u,r.channel);var c=e.data,d=0,h=0,l=0,p=o<<1,v=0,g=0,y=0,w=0,_=0,x=0,b=0,m=0,B=i.getBuffer(u*p<<2),k=i.getBuffer(3*(o+2)<<2),M=i.getBuffer((u+2)*(o+2)<<2),I=i.getBuffer(u*o<<2),z=k.i32,A=M.i32,C=I.i32,D=B.i32,S=new s(o,u,f.S32C2_t,B.data),O=1,R=o+2+1|0,E=2*(o+2)+1|0,U=o+2|0,F=U+1|0,L=0;for(t.sobelDerivatives(r,S),n>a&&(d=n,n=a,a=d),d=3*(o+2)|0;--d>=0;)z[d]=0;for(d=(u+2)*(o+2)|0;--d>=0;)A[d]=0;for(;o>h;++h,l+=2)w=D[l],_=D[l+1],z[R+h]=(w^w>>31)-(w>>31)+((_^_>>31)-(_>>31));for(d=1;u>=d;++d,l+=p){if(d===u)for(h=E+o;--h>=E;)z[h]=0;else for(h=0;o>h;h++)w=D[l+(h<<1)],_=D[l+(h<<1)+1],z[E+h]=(w^w>>31)-(w>>31)+((_^_>>31)-(_>>31));for(v=l-p|0,A[F-1]=0,g=0,h=0;o>h;++h,v+=2){if(y=z[R+h],y>n)if(w=D[v],_=D[v+1],x=w^_,w=(w^w>>31)-(w>>31)|0,_=(_^_>>31)-(_>>31)|0,b=13573*w,m=b+(w+w<<15),_<<=15,b>_){if(y>z[R+h-1]&&y>=z[R+h+1]){y>a&&!g&&2!==A[F+h-U]?(A[F+h]=2,g=1,C[L++]=F+h):A[F+h]=1;continue}}else if(_>m){if(y>z[O+h]&&y>=z[E+h]){y>a&&!g&&2!==A[F+h-U]?(A[F+h]=2,g=1,C[L++]=F+h):A[F+h]=1;continue}}else if(x=0>x?-1:1,y>z[O+h-x]&&y>z[E+h+x]){y>a&&!g&&2!==A[F+h-U]?(A[F+h]=2,g=1,C[L++]=F+h):A[F+h]=1;continue}A[F+h]=0,g=0}A[F+o]=0,F+=U,h=O,O=R,R=E,E=h}for(h=F-U-1,d=0;U>d;++d,++h)A[h]=0;for(;L>0;)F=C[--L],F-=U+1,1===A[F]&&(A[F]=2,C[L++]=F),F+=1,1===A[F]&&(A[F]=2,C[L++]=F),F+=1,1===A[F]&&(A[F]=2,C[L++]=F),F+=U,1===A[F]&&(A[F]=2,C[L++]=F),F-=2,1===A[F]&&(A[F]=2,C[L++]=F),F+=U,1===A[F]&&(A[F]=2,C[L++]=F),F+=1,1===A[F]&&(A[F]=2,C[L++]=F),F+=1,1===A[F]&&(A[F]=2,C[L++]=F);for(F=U+1,O=0,d=0;u>d;++d,F+=U)for(h=0;o>h;++h)c[O++]=255*(2===A[F+h]);i.putBuffer(B),i.putBuffer(k),i.putBuffer(M),i.putBuffer(I)},t.perspective=function(t,r,e,n){"undefined"==typeof n&&(n=0);var a,o=0|t.cols,f=0|t.rows,i=0|r.cols,u=0|r.rows,s=t.data,c=r.data,d=0,h=0,l=0,p=0,v=0,g=0,w=0,_=0,x=0,b=0,m=0,B=0,k=0,M=0,I=0,z=e.data,A=z[0],C=z[1],D=z[2],S=z[3],O=z[4],R=z[5],E=z[6],U=z[7],F=z[8];for(a=0;u>h;++h)for(_=C*h+D,x=O*h+R,b=U*h+F,d=0;i>d;++d,++a,_+=A,x+=S,b+=E)m=1/b,g=_*m,w=x*m,p=0|g,v=0|w,g>0&&w>0&&o-1>p&&f-1>v?(B=y(g-p,0),k=y(w-v,0),l=o*v+p|0,M=s[l]+B*(s[l+1]-s[l]),I=s[l+o]+B*(s[l+o+1]-s[l+o]),c[a]=M+k*(I-M)):c[a]=n},t.warp_perspective=function(r,e,n,a){t.perspective(r,e,n,a)},t.affine=function(t,r,e,n){"undefined"==typeof n&&(n=0);var a,o=t.cols,f=t.rows,i=r.cols,u=r.rows,s=t.data,c=r.data,d=0,h=0,l=0,p=0,v=0,g=0,y=0,w=0,_=0,x=0,b=0,m=e.data,B=m[0],k=m[1],M=m[2],I=m[3],z=m[4],A=m[5];for(a=0;u>h;++h)for(g=k*h+M,y=z*h+A,d=0;i>d;++d,++a,g+=B,y+=I)p=0|g,v=0|y,p>=0&&v>=0&&o-1>p&&f-1>v?(w=g-p,_=y-v,l=o*v+p,x=s[l]+w*(s[l+1]-s[l]),b=s[l+o]+w*(s[l+o+1]-s[l+o]),c[a]=x+_*(b-x)):c[a]=n},t.warp_affine=function(r,e,n,a){t.affine(r,e,n,a)},t.skinDetector=function(t,r){for(var e,n,a,o,f=t.width*t.height;f--;)o=4*f,e=t.data[o],n=t.data[o+1],a=t.data[o+2],e>95&&n>40&&a>20&&e>n&&e>a&&e-w(n,a)>15&&k(e-n)>15?r[f]=255:r[f]=0},t.skindetector=function(r,e){t.skinDetector(r,e)},t}(),I=function(){function t(t){this.levels=0|t,this.data=new Array(t),this.pyrdown=M.pyrdown}var r=t.prototype;return r.constructor=t,r.allocate=function(t,r,e){for(var n=this.levels;--n>=0;)this.data[n]=new s(t>>n,r>>n,e)},r.build=function(t,r){"undefined"==typeof r&&(r=!0);var e=this.levels,n=this.data,a=2,o=t,f=n[0];if(!r)for(var i=t.cols*t.rows;--i>=0;)f.data[i]=t.data[i];for(f=this.data[1],this.pyrdown(o,f);e>a;++a)o=f,f=n[a],this.pyrdown(o,f)},t}();f.Processing=M,f.Pyramid_t=I}(window),function(t){"use strict";var r=t.Igata,e=r,n=function(){function t(t,r,e){for(var n=0,a=i;e>n;++n)t[n]=a[n<<1]+a[(n<<1)+1]*r;for(;25>n;++n)t[n]=t[n-e]}function r(t,r,e,n,a){for(var i=25,u=0,s=t[r],c=a,d=0,h=0,l=0;i>u;++u)n[u]=s-t[r+e[u]];for(u=0;16>u;u+=2)d=o(n[u+1],n[u+2]),d=o(d,n[u+3]),c>=d||(d=o(d,n[u+4]),d=o(d,n[u+5]),d=o(d,n[u+6]),d=o(d,n[u+7]),d=o(d,n[u+8]),c=f(c,o(d,n[u])),c=f(c,o(d,n[u+9])));for(h=-c,u=0;16>u;u+=2)l=f(n[u+1],n[u+2]),l=f(l,n[u+3]),l=f(l,n[u+4]),l=f(l,n[u+5]),l>=h||(l=f(l,n[u+6]),l=f(l,n[u+7]),l=f(l,n[u+8]),h=o(h,f(l,n[u])),h=o(h,f(l,n[u+9])));return-h-1}function n(){throw new Error("FastCorner can't create instance.")}var a=e.Cache,o=e._min,f=e._max,i=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),u=new Uint8Array(512),s=new Int32Array(25),c=new Int32Array(25),d=20,h=n.prototype;return h.constructor=n,n.setThreshold=function(t){d=o(f(t,0),255);for(var r=-255;255>=r;++r)u[r+255]=-d>r?1:r>d?2:0;return d},n.set_threshold=function(t){return n.setThreshold(t)},n.detect=function(e,n,i){"undefined"==typeof i&&(i=3);var h,l=8,p=25,v=e.data,g=e.cols,y=e.rows,w=0,_=0,x=0,b=0,m=0,B=0,k=a.getBuffer(3*g),M=a.getBuffer(3*(g+1)<<2),I=k.u8,z=M.i32,A=s,C=c,D=f(3,i),S=o(y-2,y-i),O=f(3,i),R=o(g-3,g-i),E=0,U=0,F=r,L=u,T=d,G=0,P=0,N=0,V=0,q=0,Y=0,j=0,H=0,K=0,Q=0,X=0,J=0;t(A,g,16);var W=A[0],Z=A[1],$=A[2],tt=A[3],rt=A[4],et=A[5],nt=A[6],at=A[7],ot=A[8],ft=A[9],it=A[10],ut=A[11],st=A[12],ct=A[13],dt=A[14],ht=A[15],lt=3*g;for(w=0;lt>w;++w)I[w]=0;for(w=D;S>w;++w){for(j=w*g+O|0,B=(w-3)%3,Y=B*g|0,q=B*(g+1)|0,_=0;g>_;++_)I[Y+_]=0;if(V=0,S-1>w)for(_=O;R>_;++_,++j)if(G=v[j],P=-G+255,N=L[P+v[j+W]]|L[P+v[j+ot]],0!==N&&(N&=L[P+v[j+$]]|L[P+v[j+it]],N&=L[P+v[j+rt]]|L[P+v[j+st]],N&=L[P+v[j+nt]]|L[P+v[j+dt]],0!==N)){if(N&=L[P+v[j+Z]]|L[P+v[j+ft]],N&=L[P+v[j+tt]]|L[P+v[j+ut]],N&=L[P+v[j+et]]|L[P+v[j+ct]],N&=L[P+v[j+at]]|L[P+v[j+ht]],1&N)for(b=G-T,E=0,x=0;p>x;++x)if(m=v[j+A[x]],b>m){if(++E,E>l){++V,z[q+V]=_,I[Y+_]=F(v,j,A,C,T);break}}else E=0;if(2&N)for(b=G+T,E=0,x=0;p>x;++x)if(m=v[j+A[x]],m>b){if(++E,E>l){++V,z[q+V]=_,I[Y+_]=F(v,j,A,C,T);break}}else E=0}if(z[q+g]=V,w!==D)for(B=(w-4+3)%3,H=B*g|0,q=B*(g+1)|0,B=(w-5+3)%3,K=B*g|0,V=z[q+g],x=0;V>x;++x)_=z[q+x],Q=_+1|0,X=_-1|0,J=I[H+_],J>I[H+Q]&&J>I[H+X]&&J>I[K+X]&&J>I[K+_]&&J>I[K+Q]&&J>I[Y+X]&&J>I[Y+_]&&J>I[Y+Q]&&(h=n[U],h.x=_,h.y=w-1,h.score=J,U++)}return a.putBuffer(k),a.putBuffer(M),U},n}();n.setThreshold(20),e.FastCorner=n}(window),function(t){"use strict";var r=t.Igata,e=r;e.Yape06=function(){function t(t,r,e,n,a,o,f,i,u,s){var c=0,d=0,h=i*e+f|0,l=h;for(c=i;s>c;++c,h+=e,l=h)for(d=f;u>d;++d,++l)r[l]=-4*t[l]+t[l+a]+t[l-a]+t[l+o]+t[l-o]}function r(t,r,e,n,f,u,s){var c=-2*t[r]+t[r+n]+t[r-n],d=-2*t[r]+t[r+f]+t[r-f],h=t[r+u]+t[r-u]-t[r+s]-t[r-s],l=0|a((c-d)*(c-d)+4*h*h);return o(i(e-l),i(-(e+l)))}function n(){throw new Error("Yape06 can't create instance.")}var a=e._sqrt,o=e._min,f=e._max,i=e._abs,u=e.Cache,s=n.prototype;return s.constructor=n,n.threshold=30,n.laplacian_threshold=n.threshold,n.thresholdMin=25,n.min_eigen_value_threshold=n.thresholdMin,n.detect=function(e,a,i){"undefined"==typeof i&&(i=5);var s,c=0,d=0,h=e.cols,l=e.rows,p=e.data,v=5,g=5*h|0,y=3+3*h|0,w=3-3*h|0,_=u.getBuffer(h*l<<2),x=_.i32,b=0,m=0,B=0,k=0,M=0,I=n.threshold,z=n.thresholdMin,A=0|f(5,i),C=0|f(3,i),D=0|o(h-5,h-i),S=0|o(l-3,l-i);for(c=h*l;--c>=0;)x[c]=0;for(t(p,x,h,l,v,g,A,C,D,S),m=C*h+A|0,d=C;S>d;++d,m+=h)for(c=A,B=m;D>c;++c,++B)b=x[B],(-I>b&&b<x[B-1]&&b<x[B+1]&&b<x[B-h]&&b<x[B+h]&&b<x[B-h-1]&&b<x[B+h-1]&&b<x[B-h+1]&&b<x[B+h+1]||b>I&&b>x[B-1]&&b>x[B+1]&&b>x[B-h]&&b>x[B+h]&&b>x[B-h-1]&&b>x[B+h-1]&&b>x[B-h+1]&&b>x[B+h+1])&&(k=r(p,B,b,v,g,y,w),k>z&&(s=a[M],s.x=c,s.y=d,s.score=k,++M,++c,++B));return u.putBuffer(_),M},n}()}(window),function(t){"use strict";var r=t.Igata,e=r;e.Yape=function(){function t(t,r,e){var n,a,o=0;for(n=e,a=0;n>a;a=a+1|0,o=o+1|0)n=f(e*e-a*a)+.5|0,r[o]=n+t*a;for(n--;a>n&&n>=0;n--,o=o+1|0)a=f(e*e-n*n)+.5|0,r[o]=n+t*a;for(;a>-n;n--,o=o+1|0)a=f(e*e-n*n)+.5|0,r[o]=n+t*a;for(a--;a>=0;a--,o++)n=-f(e*e-a*a)-.5|0,r[o]=n+t*a;for(;a>n;a--,o=o+1|0)n=-f(e*e-a*a)-.5|0,r[o]=n+t*a;for(n++;0>=n;n=n+1|0,o=o+1|0)a=-f(e*e-n*n)-.5|0,r[o]=n+t*a;for(;-a>n;n=n+1|0,o=o+1|0)a=-f(e*e-n*n)-.5|0,r[o]=n+t*a;for(a++;0>a;a=a+1|0,o=o+1|0)n=f(e*e-a*a)+.5|0,r[o]=n+t*a;return r[o]=r[0],r[o+1]=r[1],o}function r(t,r,e){var n=0;return 0!==t[r+1]&&n++,0!==t[r-1]&&n++,0!==t[r+e]&&n++,0!==t[r+e+1]&&n++,0!==t[r+e-1]&&n++,0!==t[r-e]&&n++,0!==t[r-e+1]&&n++,0!==t[r-e-1]&&n++,n}function n(t,r,e,n,a){var o,f;if(e>0)for(r-=n*a,f=-a;a>=f;++f){for(o=-a;a>=o;++o)if(t[r+o]>e)return!1;r+=n}else for(r-=n*a,f=-a;a>=f;++f){for(o=-a;a>=o;++o)if(t[r+o]<e)return!1;r+=n}return!0}function a(t,r,e,n,a,o,f,i){var u=0,s=0,c=f-1|0,d=0,h=0,l=0,p=0,v=0;if(d=t[r+o[s]],a>=d)if(d>=n)if(h=t[r+o[c]],a>=h){if(h>=n)return void(e[r]=0);if(c++,l=t[r+o[c]],l>a)if(c++,p=t[r+o[c]],p>a)v=3;else{if(!(n>p))return void(e[r]=0);v=6}else if(c++,p=t[r+o[c]],p>a)v=7;else{if(!(n>p))return void(e[r]=0);v=2}}else if(c++,l=t[r+o[c]],l>a)if(c++,p=t[r+o[c]],p>a)v=3;else{if(!(n>p))return void(e[r]=0);v=6}else{if(!(n>l))return void(e[r]=0);if(c++,p=t[r+o[c]],p>a)v=7;else{if(!(n>p))return void(e[r]=0);v=2}}else{if(h=t[r+o[c]],h>a)return void(e[r]=0);if(c++,l=t[r+o[c]],l>a)return void(e[r]=0);if(c++,p=t[r+o[c]],p>a)return void(e[r]=0);v=1}else{if(h=t[r+o[c]],n>h)return void(e[r]=0);if(c++,l=t[r+o[c]],n>l)return void(e[r]=0);if(c++,p=t[r+o[c]],n>p)return void(e[r]=0);v=0}for(s=1;f>=s;s++)switch(d=t[r+o[s]],v){case 0:if(d>a){if(l=p,c++,p=t[r+o[c]],n>p)return void(e[r]=0);u-=d+l,v=0;break}if(n>d){if(l>a)return void(e[r]=0);if(p>a)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],p>a)return void(e[r]=0);u-=d+l,v=8;break}if(a>=l)return void(e[r]=0);if(a>=p)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],p>a){u-=d+l,v=3;break}if(n>p){u-=d+l,v=6;break}return void(e[r]=0);case 1:if(n>d){if(l=p,c++,p=t[r+o[c]],p>a)return void(e[r]=0);u-=d+l,v=1;break}if(d>a){if(n>l)return void(e[r]=0);if(n>p)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],n>p)return void(e[r]=0);u-=d+l,v=9;break}if(l>=n)return void(e[r]=0);if(p>=n)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],n>p){u-=d+l,v=2;break}if(p>a){u-=d+l,v=7;break}return void(e[r]=0);case 2:if(d>a)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],n>d){if(p>a)return void(e[r]=0);u-=d+l,v=4;break}if(p>a){u-=d+l,v=7;break}if(n>p){u-=d+l,v=2;break}return void(e[r]=0);case 3:if(n>d)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],d>a){if(n>p)return void(e[r]=0);u-=d+l,v=5;break}if(p>a){u-=d+l,v=3;break}if(n>p){u-=d+l,v=6;break}return void(e[r]=0);case 4:if(d>a)return void(e[r]=0);if(n>d){if(l=p,c++,p=t[r+o[c]],p>a)return void(e[r]=0);u-=d+l,v=1;break}if(p>=n)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],n>p){u-=d+l,v=2;break}if(p>a){u-=d+l,v=7;break}return void(e[r]=0);case 5:if(n>d)return void(e[r]=0);if(d>a){if(l=p,c++,p=t[r+o[c]],n>p)return void(e[r]=0);u-=d+l,v=0;break}if(a>=p)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],p>a){u-=d+l,v=3;break}if(n>p){u-=d+l,v=6;break}return void(e[r]=0);case 7:if(d>a)return void(e[r]=0);if(n>d)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],p>a){u-=d+l,v=3;break}if(n>p){u-=d+l,v=6;break}return void(e[r]=0);case 6:if(d>a)return void(e[r]=0);if(n>d)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],n>p){u-=d+l,v=2;break}if(p>a){u-=d+l,v=7;break}return void(e[r]=0);case 8:if(d>a){if(n>p)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],n>p)return void(e[r]=0);u-=d+l,v=9;break}if(n>d){if(l=p,c++,p=t[r+o[c]],p>a)return void(e[r]=0);u-=d+l,v=1;break}return void(e[r]=0);case 9:if(n>d){if(p>a)return void(e[r]=0);if(l=p,c++,p=t[r+o[c]],p>a)return void(e[r]=0);u-=d+l,v=8;break}if(d>a){if(l=p,c++,p=t[r+o[c]],n>p)return void(e[r]=0);u-=d+l,v=0;break}return void(e[r]=0)}e[r]=u+i*t[r]}function o(){throw new Error("Yape can't create instance.")}var f=e._sqrt,i=e._min,u=e._max,s=(e._abs,function(){function r(r,e,n){var a=new Int32Array(1024);this.dirs=a,this.dirs_count=0|t(r,a,n),this.scores=new Int32Array(r*e),this.radius=0|n}var e=r.prototype;return e.constructor=r,r}()),c=o.prototype;return c.constructor=o,o.level_tables=[],o.tau=7,o.init=function(t,r,e,n){"undefined"==typeof n&&(n=1);var a;for(e=i(e,7),e=u(e,3),a=0;n>a;++a)this.level_tables[a]=new s(t>>a,r>>a,e)},o.detect=function(t,e,f){"undefined"==typeof f&&(f=4);var s,c=o.level_tables[0],d=0|c.radius,h=d-1|0,l=c.dirs,p=0|c.dirs_count,v=p>>1,g=t.data,y=0|t.cols,w=0|t.rows,_=y>>1,x=c.scores,b=0,m=0,B=0,k=0,M=0,I=0,z=0,A=0,C=0|o.tau,D=0,S=0|u(d+1,f),O=0|u(d+1,f),R=0|i(y-d-2,y-f),E=0|i(w-d-2,w-f);for(B=O*y+S|0,m=O;E>m;++m,B+=y)for(b=S,k=B;R>b;++b,++k)M=g[k]+C,I=g[k]-C,I<g[k+d]&&g[k+d]<M&&I<g[k-d]&&g[k-d]<M?x[k]=0:a(g,k,x,I,M,l,v,p);for(B=O*y+S|0,m=O;E>m;++m,B+=y)for(b=S,k=B;R>b;++b,++k)A=x[k],z=Math.abs(A),5>z?(++b,++k):r(x,k,y)>=3&&n(x,k,A,_,d)&&(s=e[D],s.x=b,s.y=m,s.score=z,++D,b+=h,k+=h);return D},o}()}(window),function(t){"use strict";var r=t.Igata,e=r;e.Orb=function(){function t(t,r,e,n,a,o){var s=i(e),d=u(e);c.data[0]=s,c.data[1]=-d,c.data[2]=(-s+d)*o*.5+n,c.data[3]=d,c.data[4]=s,c.data[5]=(-d-s)*o*.5+a,f.affine(t,r,c,128)}function n(){throw new Error("Orb can't create instance.")}var a=e.U8_t,o=e.Matrix_t,f=e.Processing,i=e._cos,u=e._sin,s=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),c=new o(3,3,r.F32_t|r.C1_t),d=new o(32,32,a|r.C1_t),h=n.prototype;return h.constructor=n,n.describe=function(r,e,n,o){var f=32,i=0,u=0,c=0,h=0,l=0,p=0,v=0,g=0,y=(r.data,r.cols,r.rows,d.data),w=528,_=0;o.type&a?o.resize(f,n,1):(o.type=a,o.cols=f,o.rows=n,o.channel=1,o.allocate());var x=o.data,b=0;for(i=0;n>i;++i){for(c=e[i].x,h=e[i].y,l=e[i].angle,t(r,d,l,c,h,32),_=0,u=0;f>u;++u)p=y[w+32*s[_+1]+s[_]],_+=2,v=y[w+32*s[_+1]+s[_]],_+=2,g=v>p|0,p=y[w+32*s[_+1]+s[_]],_+=2,v=y[w+32*s[_+1]+s[_]],_+=2,g|=(v>p)<<1,p=y[w+32*s[_+1]+s[_]],_+=2,v=y[w+32*s[_+1]+s[_]],_+=2,g|=(v>p)<<2,p=y[w+32*s[_+1]+s[_]],_+=2,v=y[w+32*s[_+1]+s[_]],_+=2,g|=(v>p)<<3,p=y[w+32*s[_+1]+s[_]],_+=2,v=y[w+32*s[_+1]+s[_]],_+=2,g|=(v>p)<<4,p=y[w+32*s[_+1]+s[_]],_+=2,v=y[w+32*s[_+1]+s[_]],_+=2,g|=(v>p)<<5,p=y[w+32*s[_+1]+s[_]],_+=2,v=y[w+32*s[_+1]+s[_]],_+=2,g|=(v>p)<<6,p=y[w+32*s[_+1]+s[_]],_+=2,v=y[w+32*s[_+1]+s[_]],_+=2,g|=(v>p)<<7,x[b+u]=g;b+=f}},n}()}(window),function(t){"use strict";var r=t.Igata,e=r;e.Kanade=function(){function t(){throw new Error("Kanade can't create instance.")}var n=e.Cache,a=e.Matrix_t,o=e.Processing.scharrDerivatives,f=t.prototype;return f.constructor=t,t.track=function(t,e,f,i,u,s,c,d,h,l){"undefined"==typeof c&&(c=30),"undefined"==typeof d&&(d=new Uint8Array(u)),"undefined"==typeof h&&(h=.01),"undefined"==typeof l&&(l=1e-4);var p=.5*(s-1),v=s*s|0,g=v<<1,y=t.data,w=e.data,_=y[0].data,x=w[0].data,b=y[0].cols,m=y[0].rows,B=0,k=0,M=n.getBuffer(v<<2),I=n.getBuffer(g<<2),z=n.getBuffer(m*(b<<1)<<2),A=new a(b,m,r.S32C2_t,z.data),C=M.i32,D=I.i32,S=z.i32,O=0,R=0,E=0,U=0,F=0,L=0,T=0,G=0,P=0,N=0,V=0,q=0,Y=0,j=0,H=0,K=0,Q=0,X=0,J=0,W=0,Z=0,$=0,tt=0,rt=0,et=0,nt=0,at=0,ot=0,ft=0,it=0,ut=0,st=0,ct=0,dt=14,ht=14,lt=ht-5,pt=1<<lt-1,vt=1<<dt,gt=1<<ht-1,yt=1/(1<<20),wt=0,_t=0,xt=0,bt=0,mt=0,Bt=0,kt=0,Mt=0,It=0,zt=0,At=0,Ct=0,Dt=1.1920929e-7;
for(h*=h;u>W;++W)d[W]=1;var St=t.levels-1|0;for(rt=St;rt>=0;--rt)for(T=1/(1<<rt),B=b>>rt,k=m>>rt,O=B<<1,_=y[rt].data,x=w[rt].data,ot=B-s|0,ft=k-s|0,o(y[rt],A),et=0;u>et;++et)if(W=et<<1,Z=W+1,G=f[W]*T,P=f[Z]*T,rt===St?(N=G,V=P):(N=2*i[W],V=2*i[Z]),i[W]=N,i[Z]=V,G-=p,P-=p,K=0|G,Q=0|P,$=at>=K|K>=ot|at>=Q|Q>=ft,0===$){for(it=G-K,ut=P-Q,wt=(1-it)*(1-ut)*vt+.5|0,_t=it*(1-ut)*vt+.5|0,xt=(1-it)*ut*vt+.5|0,bt=vt-wt-_t-xt,Mt=0,It=0,zt=0,tt=0;s>tt;++tt)for(R=(tt+Q)*B+K|0,E=R<<1,U=tt*s|0,F=U<<1,$=0;s>$;++$,++R,++U,E+=2)mt=_[R]*wt+_[R+1]*_t+_[R+B]*xt+_[R+B+1]*bt,mt=mt+pt>>lt,Bt=S[E]*wt+S[E+2]*_t+S[E+O]*xt+S[E+O+2]*bt,Bt=Bt+gt>>ht,kt=S[E+1]*wt+S[E+3]*_t+S[E+O+1]*xt+S[E+O+3]*bt,kt=kt+gt>>ht,C[U]=mt,D[F++]=Bt,D[F++]=kt,Mt+=Bt*Bt,It+=Bt*kt,zt+=kt*kt;if(Mt*=yt,It*=yt,zt*=yt,At=Mt*zt-It*It,Ct=(zt+Mt-Math.sqrt((Mt-zt)*(Mt-zt)+4*It*It))/g,l>Ct||Dt>At)0===rt&&(d[et]=0);else for(At=1/At,N-=p,V-=p,q=0,Y=0,nt=0;c>nt;++nt){if(X=0|N,J=0|V,$=at>=X|X>=ot|at>=J|J>=ft,0!==$){0===rt&&(d[et]=0);break}for(it=N-X,ut=V-J,wt=(1-it)*(1-ut)*vt+.5|0,_t=it*(1-ut)*vt+.5|0,xt=(1-it)*ut*vt+.5|0,bt=vt-wt-_t-xt,st=0,ct=0,tt=0;s>tt;++tt)for(L=(tt+J)*B+X|0,U=tt*s|0,F=U<<1,$=0;s>$;++$,++L,++U)mt=x[L]*wt+x[L+1]*_t+x[L+B]*xt+x[L+B+1]*bt,mt=mt+pt>>lt,mt-=C[U],st+=mt*D[F++],ct+=mt*D[F++];if(st*=yt,ct*=yt,j=(It*ct-zt*st)*At,H=(It*st-Mt*ct)*At,N+=j,V+=H,i[W]=N+p,i[Z]=V+p,h>=j*j+H*H)break;if(nt>0&&Math.abs(j+q)<.01&&Math.abs(H+Y)<.01){i[W]-=.5*j,i[Z]-=.5*H;break}q=j,Y=H}}else 0===rt&&(d[et]=0);n.putBuffer(M),n.putBuffer(I),n.putBuffer(z)},t}()}(window),function(t){"use strict";var r=t.Igata,e=r;e.Haar=function(){function t(t,r){var e=.25*t.width+.5|0;return r.x<=t.x+e&&r.x>=t.x-e&&r.y<=t.y+e&&r.y>=t.y-e&&r.width<=1.5*t.width+.5|0&&1.5*r.width+.5|0>=t.width}function r(){throw new Error("Haar can't create instance.")}var e=r.prototype;return e.constructor=r,r.desity=.07,r.edges_density=r.desity,r.singleScale=function(t,e,n,a,o,f,i,u){var s,c,d,h,l,p,v,g,y,w,_,x,b,m,B,k,M,I,z,A,C,D,S,O,R,E,U,F=u.size[0]*i|0,L=u.size[1]*i|0,T=.5*i+1.5|0,G=T,P=o-F|0,N=f-L|0,V=o+1|0,q=1/(F*L),Y=!0,j=0,H=F,K=L*V,Q=K+F,X=F*L*255*r.desity|0,J=[];for(l=0;N>l;l+=G)for(j=l*V,h=0;P>h;h+=T,j+=T)if(v=t[j]-t[j+H]-t[j+K]+t[j+Q],a&&(p=a[j]-a[j+H]-a[j+K]+a[j+Q],X>p||20>v))h+=T,j+=T;else{for(v*=q,g=(e[j]-e[j+H]-e[j+K]+e[j+Q])*q-v*v,y=g>0?Math.sqrt(g):1,w=u.complexClassifiers,m=w.length,Y=!0,s=0;m>s;++s){for(_=w[s],M=_.threshold,x=_.simpleClassifiers,B=x.length,I=0,c=0;B>c;++c){if(b=x[c],z=0,C=b.features,k=C.length,U=b.tilted,U||1===U)for(d=0;k>d;++d)A=C[d],D=~~(h+A[0]*i)+~~(l+A[1]*i)*V,R=~~(A[2]*i),E=~~(A[3]*i),S=R*V,O=E*V,z+=(n[D]-n[D+R+S]-n[D-E+O]+n[D+R-E+S+O])*A[4];else for(d=0;k>d;++d)A=C[d],D=~~(h+A[0]*i)+~~(l+A[1]*i)*V,R=~~(A[2]*i),E=~~(A[3]*i),O=E*V,z+=(t[D]-t[D+R]-t[D+O]+t[D+O+R])*A[4];I+=z*q<b.threshold*y?b.left_val:b.right_val}if(M>I){Y=!1;break}}Y&&(J.push({x:h,y:l,width:F,height:L,neighbor:1,confidence:I}),h+=T,j+=T)}return J},r.detect_single_scale=function(t,e,n,a,o,f,i,u){return r.singleScale(t,e,n,a,o,f,i,u)},r.multiScale=function(t,e,n,a,o,f,i,u,s){"undefined"==typeof u&&(u=1.2),"undefined"==typeof s&&(s=1);for(var c=i.size[0],d=i.size[1],h=[];o>s*c&&f>s*d;)h=h.concat(r.singleScale(t,e,n,a,o,f,s,i)),s*=u;return h},r.detect_multi_scale=function(t,e,n,a,o,f,i,u,s){return r.multiScale(t,e,n,a,o,f,i,u,s)},r.rectangles=function(r,e){"undefined"==typeof e&&(e=1);var n,a,o=r.length,f=[];for(n=0;o>n;++n)f[n]={parent:-1,element:r[n],rank:0};for(n=0;o>n;++n)if(f[n].element){for(var i=n;-1!==f[i].parent;)i=f[i].parent;for(a=0;o>a;++a)if(n!==a&&f[a].element&&t(f[n].element,f[a].element)){for(var u=a;-1!==f[u].parent;)u=f[u].parent;if(u!==i){f[i].rank>f[u].rank?f[u].parent=i:(f[i].parent=u,f[i].rank===f[u].rank&&f[u].rank++,i=u);for(var s,c=a;-1!==f[c].parent;)s=c,c=f[c].parent,f[s].parent=i;for(c=n;-1!==f[c].parent;)s=c,c=f[c].parent,f[s].parent=i}}}var d=[],h=0;for(n=0;o>n;n++){a=-1;var l=n;if(f[l].element){for(;-1!==f[l].parent;)l=f[l].parent;f[l].rank>=0&&(f[l].rank=~h++),a=~f[l].rank}d[n]=a}var p=[];for(n=0;h+1>n;++n)p[n]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};var v;for(n=0;o>n;++n)w=r[n],v=d[n],0===p[v].neighbors&&(p[v].confidence=w.confidence),++p[v].neighbors,p[v].x+=w.x,p[v].y+=w.y,p[v].width+=w.width,p[v].height+=w.height,p[v].confidence=Math.max(p[v].confidence,w.confidence);var g=[];for(n=0;h>n;++n)o=p[n].neighbors,o>=e&&g.push({x:(2*p[n].x+o)/(2*o),y:(2*p[n].y+o)/(2*o),width:(2*p[n].width+o)/(2*o),height:(2*p[n].height+o)/(2*o),neighbors:p[n].neighbors,confidence:p[n].confidence});var y=[];for(o=g.length,n=0;o>n;++n){var w=g[n],_=!0;for(a=0;o>a;++a){var x=g[a],b=.25*x.width+.5|0;if(n!==a&&w.x>=x.x-b&&w.y>=x.y-b&&w.x+w.width<=x.x+x.width+b&&w.y+w.height<=x.y+x.height+b&&(x.neighbors>Math.max(3,w.neighbors)||w.neighbors<3)){_=!1;break}}_&&y.push(w)}return y},r.group_rectangles=function(t,e){return r.rectangles(t,e)},r}()}(window),function(t){"use strict";var r=t.Igata,e=r;e.Bbf=function(){function t(t,r){var e=.25*t.width+.5|0;return r.x<=t.x+e&&r.x>=t.x-e&&r.y<=t.y+e&&r.y>=t.y-e&&r.width<=1.5*t.width+.5|0&&1.5*r.width+.5|0>=t.width}function n(){throw new Error("Bbf can't create instance.")}var a=e.Processing,o=e.Matrix_t,f=e.U8_t,i=e.C1_t,u=e._pow,s=e._log,c=e._min,d=new r.Pyramid_t(1),h=n.prototype;return h.constructor=n,n.interval=4,n.scale=1.1486,n.next=5,n.scaleTo=1,n.scale_to=n.scaleTo,n.prepare=function(t){for(var r=t.stage_classifier.length,e=0;r>e;e++)for(var n=t.stage_classifier[e].feature,a=t.stage_classifier[e].count,o=t.stage_classifier[e]._feature=new Array(a),f=0;a>f;f++)o[f]={size:n[f].size,px:new Array(n[f].size),pz:new Array(n[f].size),nx:new Array(n[f].size),nz:new Array(n[f].size)}},n.prepare_cascade=function(t){n.prepare(t)},n.pyramid=function(t,r,e,h){"undefined"==typeof h&&(h=4);var l,p=t.cols,v=t.rows,g=0,y=0,w=0,_=!1,x=t,b=t,m=f|i;n.interval=h,l=u(2,1/(h+1)),n.scale=l,n.next=h+1|0,n.scaleTo=s(c(p/r,v/e))/s(l)|0;var B,k=4*(n.scaleTo+2*n.next)|0;for(d.levels!==k&&(d.levels=k,d.data=new Array(k),_=!0,d.data[0]=t),B=h,g=1;B>=g;++g)y=p/u(l,g)|0,w=v/u(l,g)|0,x=d.data[g<<2],(_||y!==x.cols||w!==x.rows)&&(d.data[g<<2]=new o(y,w,m),x=d.data[g<<2]),a.resample(t,x,y,w);for(B=n.scaleTo+2*n.next,g=n.next;B>g;++g)b=d.data[(g<<2)-(this.next<<2)],x=d.data[g<<2],y=b.cols>>1,w=b.rows>>1,(_||y!==x.cols||w!==x.rows)&&(d.data[g<<2]=new o(y,w,m),x=d.data[g<<2]),a.pyrdown(b,x);for(B=n.scaleTo+2*n.next,g=2*n.next;B>g;++g)b=d.data[(g<<2)-(this.next<<2)],y=b.cols>>1,w=b.rows>>1,x=d.data[(g<<2)+1],(_||y!==x.cols||w!==x.rows)&&(d.data[(g<<2)+1]=new o(y,w,m),x=d.data[(g<<2)+1]),a.pyrdown(b,x,1,0),x=d.data[(g<<2)+2],(_||y!==x.cols||w!==x.rows)&&(d.data[(g<<2)+2]=new o(y,w,m),x=d.data[(g<<2)+2]),a.pyrdown(b,x,0,1),x=d.data[(g<<2)+3],(_||y!==x.cols||w!==x.rows)&&(d.data[(g<<2)+3]=new o(y,w,m),x=d.data[(g<<2)+3]),a.pyrdown(b,x,1,1);return d},n.build_pyramid=function(t,r,e,a){return n.pyramid(t,r,e,a)},n.detect=function(t,r){var e,a,o,f,i,u=n.scale,s=n.next,c=n.scaleTo,d=0,h=0,l=0,p=0,v=0,g=0,y=0,w=0,_=0,x=0,b=0,m=0,B=0,k=0,M=0,I=0,z=0,A=0,C=!0,D=!0,S=1,O=1,R=[0,1,0,1],E=[0,0,1,1],U=[],F=t.data,L=1,T=2,G=4,P=[],N=[0,0,0],V=[0,0,0],q=[0,0,0];for(d=0;c>d;d++){for(M=d<<2,I=F[M+(s<<3)].cols-(r.width>>2),z=F[M+(s<<3)].rows-(r.height>>2),V[0]=F[M].cols*L,V[1]=F[M+(s<<2)].cols*L,V[2]=F[M+(s<<3)].cols*L,q[0]=F[M].cols*G-I*G,q[1]=F[M+(s<<2)].cols*T-I*T,q[2]=F[M+(s<<3)].cols*L-I*L,w=r.stage_classifier.length,h=0;w>h;h++)for(o=r.stage_classifier[h].feature,a=r.stage_classifier[h]._feature,_=r.stage_classifier[h].count,l=0;_>l;l++)for(f=a[l],i=o[l],x=0|i.size,y=0;x>y;y++)f.px[y]=i.px[y]*L+i.py[y]*V[i.pz[y]],f.pz[y]=i.pz[y],f.nx[y]=i.nx[y]*L+i.ny[y]*V[i.nz[y]],f.nz[y]=i.nz[y];for(P[0]=F[M].data,P[1]=F[M+(s<<2)].data,y=0;4>y;y++)for(P[2]=F[M+(s<<3)+y].data,N[0]=R[y]*T+E[y]*(F[M].cols*T),N[1]=R[y]*L+E[y]*(F[M+(s<<2)].cols*L),N[2]=0,g=0;z>g;g++){for(v=0;I>v;v++){for(A=0,C=!0,w=r.stage_classifier.length,h=0;w>h;h++){for(A=0,e=r.stage_classifier[h].alpha,a=r.stage_classifier[h]._feature,_=r.stage_classifier[h].count,l=0;_>l;l++)if(f=a[l],m=P[f.pz[0]][N[f.pz[0]]+f.px[0]],B=P[f.nz[0]][N[f.nz[0]]+f.nx[0]],B>=m)A+=e[l<<1];else{for(D=!0,x=f.size,k=1;x>k;k++){if(f.pz[k]>=0&&(b=P[f.pz[k]][N[f.pz[k]]+f.px[k]],m>b)){if(B>=b){D=!1;break}m=b}if(f.nz[k]>=0&&(p=P[f.nz[k]][N[f.nz[k]]+f.nx[k]],p>B)){if(p>=m){D=!1;break}B=p}}A+=D?e[(l<<1)+1]:e[l<<1]}if(A<r.stage_classifier[h].threshold){C=!1;break}}C&&(U.push({x:(4*v+2*R[y])*S,y:(4*g+2*E[y])*O,width:r.width*S,height:r.height*O,neighbor:1,confidence:A}),++v,N[0]+=G,N[1]+=T,N[2]+=L),N[0]+=G,N[1]+=T,N[2]+=L}N[0]+=q[0],N[1]+=q[1],N[2]+=q[2]}S*=u,O*=u}return U},n.rectangles=function(r,e){"undefined"==typeof e&&(e=1);var n,a,o=r.length,f=[];for(n=0;o>n;++n)f[n]={parent:-1,element:r[n],rank:0};for(n=0;o>n;++n)if(f[n].element){for(var i=n;-1!==f[i].parent;)i=f[i].parent;for(a=0;o>a;++a)if(n!==a&&f[a].element&&t(f[n].element,f[a].element)){for(var u=a;-1!==f[u].parent;)u=f[u].parent;if(u!==i){f[i].rank>f[u].rank?f[u].parent=i:(f[i].parent=u,f[i].rank===f[u].rank&&f[u].rank++,i=u);for(var s,c=a;-1!==f[c].parent;)s=c,c=f[c].parent,f[s].parent=i;for(c=n;-1!==f[c].parent;)s=c,c=f[c].parent,f[s].parent=i}}}var d=[],h=0;for(n=0;o>n;n++){a=-1;var l=n;if(f[l].element){for(;-1!==f[l].parent;)l=f[l].parent;f[l].rank>=0&&(f[l].rank=~h++),a=~f[l].rank}d[n]=a}var p,v=[],g=h+1;for(n=0;g>n;++n)v[n]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(n=0;o>n;++n)_=r[n],p=d[n],0===v[p].neighbors&&(v[p].confidence=_.confidence),++v[p].neighbors,v[p].x+=_.x,v[p].y+=_.y,v[p].width+=_.width,v[p].height+=_.height,v[p].confidence=Math.max(v[p].confidence,_.confidence);var y=[];for(n=0;h>n;++n)o=v[n].neighbors,o>=e&&y.push({x:(2*v[n].x+o)/(2*o),y:(2*v[n].y+o)/(2*o),width:(2*v[n].width+o)/(2*o),height:(2*v[n].height+o)/(2*o),neighbors:v[n].neighbors,confidence:v[n].confidence});var w=[];for(o=y.length,n=0;o>n;++n){var _=y[n],x=!0;for(a=0;o>a;++a){var b=y[a],m=.25*b.width+.5|0;if(n!==a&&_.x>=b.x-m&&_.y>=b.y-m&&_.x+_.width<=b.x+b.width+m&&_.y+_.height<=b.y+b.height+m&&(b.neighbors>Math.max(3,_.neighbors)||_.neighbors<3)){x=!1;break}}x&&w.push(_)}return w},n.group_rectangles=function(t,r){return n.rectangles(t,r)},n}()}(window);