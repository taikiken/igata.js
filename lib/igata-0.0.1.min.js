/*!
 * license inazumatv.com
 * author (at)taikiken / http://inazumatv.com
 * date 2015/04/20 - 16:51
 *
 * Copyright (c) 2011-2015 inazumatv.com, inc.
 *
 * Distributed under the terms of the MIT license.
 * http://www.opensource.org/licenses/mit-license.html
 *
 * This notice shall be included in all copies or substantial portions of the Software.
 *
 * thanks
 * gl-matrix
 * https://github.com/toji/gl-matrix
 *
 * html5rocks.com
 * http://www.html5rocks.com/en/tutorials/canvas/imagefilters/
 *
 * Blur by Mario Klingemann
 * http://www.quasimondo.com/StackBlurForCanvas/StackBlurDemo.html
 *
 * version 0.0.1
 * build 2015-09-04 21:45:24
 * git https://github.com/taikiken/igata.js
 *
 */
var Igata=window.Igata||{};!function(t){"use strict";var n=t.Igata;n.Float32Array=t.Float32Array,n._random=Math.random,n._abs=Math.abs,n._min=Math.min,n._max=Math.max,n._sqrt=Math.sqrt,n._cos=Math.cos,n._sin=Math.sin,n._round=Math.round,n._floor=Math.floor,n._exp=Math.exp,n._PI=Math.PI,n.EPSILON=1e-6,n.extend=function(t,n){n.prototype=Object.create(t.prototype),n.prototype.constructor=n}}(window),function(t){"use strict";var n=t.Igata;n.Bitmap=function(){function t(t,n){this.identity=null,Object.defineProperties(this,{context:{get:function(){return t}},img:{get:function(){return n}}})}var n=t.prototype;return n.constructor=t,n.get=function(t,n,r,a){var e=this.context,o=this.img;return o&&(r=r||o.width,a=a||o.height),t=t||0,n=n||0,e.getImageData(t,n,r,a)},n.save=function(t){this.identity=new Uint8ClampedArray(t)},t}()}(window),function(t){"use strict";var n=t.Igata;n.Filter=function(){function t(t){Object.defineProperties(this,{bitmap:{get:function(){return t},set:function(n){t=n}}})}var n=t.prototype;return n.constructor=t,n.filter=function(){},n.imageData=function(t){var n=t.get();return t.identity||t.save(n.data),n},n.restore=function(){var t,n=this.bitmap,r=n.get(),a=n.identity;a&&(r.data.set(a),t=n.context,t.putImageData(r,0,0))},t}()}(window),function(t){"use strict";var n=t.Igata;n.Invert=function(){function t(t){r.call(this,t)}var r=n.Filter;n.extend(r,t);var a=t.prototype;return a.constructor=t,a.filter=function(){var t,n,r,a,e=this.bitmap,o=e.context,i=this.imageData(e);for(t=i.data,n=0,r=t.length;r>n;n=n+4|0)a=n,t[a]=255-t[a],a=n+1,t[a]=255-t[a],a=n+2,t[a]=255-t[a];o.putImageData(i,0,0)},t}()}(window),function(t){"use strict";var n=t.Igata;n.Brightness=function(){function t(t){r.call(this,t)}var r=n.Filter;n.extend(r,t);var a=t.prototype;return a.constructor=t,a.filter=function(t){var n,r,a,e,o,i=this.bitmap,u=i.context,c=this.imageData(i);for(n=new Uint8ClampedArray(i.identity),r=2.55*t,e=0,o=n.length;o>e;e=e+4|0)a=e,n[a]=r+n[a],a=e+1,n[a]=r+n[a],a=e+2,n[a]=r+n[a];c.data.set(n),u.putImageData(c,0,0)},t}()}(window),function(t){"use strict";var n=t.Igata;n.Grayscale=function(){function t(t){r.call(this,t)}var r=n.Filter;n.extend(r,t);var a=t.prototype;return a.constructor=t,a.filter=function(){var n=this.bitmap,r=n.context,a=this.imageData(n);t.to(a.data),r.putImageData(a,0,0)},t.to=function(t){var n,r,a,e,o,i,u;for(n=0,r=t.length;r>n;n=n+4|0)a=n+1,e=n+2,o=t[n],i=t[a],u=t[e],t[n]=t[a]=t[e]=.2126*o+.7152*i+.0722*u},t}()}(window),function(t){"use strict";var n=t.Igata;n.Sepia=function(){function t(t){r.call(this,t)}var r=n.Filter;n.extend(r,t);var a=t.prototype;return a.constructor=t,a.filter=function(){var t,n,r,a,e,o,i,u,c=this.bitmap,s=c.context,f=this.imageData(c);for(t=f.data,n=0,r=t.length;r>n;n=n+4|0)a=n+1,e=n+2,o=t[n],i=t[a],u=t[e],t[n]=.393*o+.769*i+.189*u,t[a]=.349*o+.686*i+.168*u,t[e]=.272*o+.534*i+.131*u;s.putImageData(f,0,0)},t}()}(window),function(t){"use strict";var n=t.Igata;n.Threshold=function(){function t(t){r.call(this,t)}var r=n.Filter;n.extend(r,t);var a=t.prototype;return a.constructor=t,a.filter=function(t){var n,r,a,e,o,i,u,c,s,f=this.bitmap,l=f.context,h=this.imageData(f);for(t=t||128,n=h.data,r=0,a=n.length;a>r;r=r+4|0)u=r+1,c=r+2,e=n[r],o=n[u],i=n[c],s=.2126*e+.7152*o+.0722*i>=t?255:0,n[r]=n[u]=n[c]=s;l.putImageData(h,0,0)},t}()}(window),function(t){"use strict";var n=t.Igata,r=function(){function t(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var n=t.prototype;return n.constructor=t,t}();n.Blur=function(){function t(t){a.call(this,t)}var a=n.Filter,e=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],o=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];n.extend(a,t);var i=t.prototype;return i.constructor=t,i.filter=function(t,n){var r,a=this.bitmap,e=a.context,o=this.imageData(a);r=new Uint8ClampedArray(a.identity),isNaN(t)&&(t=8),t|=0,0!==t?(n?this._rgba(r,t,o.width,o.height):this._rgb(r,t,o.width,o.height),o.data.set(r),e.putImageData(o,0,0)):this.restore()},i._rgba=function(t,n,a,i){var u,c,s,f,l,h,g,v,d,p,m,w,x,b,y,I,D,_,M,F,A,C,U,P,N,q=n+n+1,O=a-1,j=i-1,z=n+1,B=z*(z+1)/2,E=new r,G=E;for(s=1;q>s;s=s+1|0)G=G.next=new r,s===z&&(N=G);G.next=E;var S=null,T=null;g=h=0;var k=e[n],L=o[n];for(c=0;i>c;c=c+1|0){for(I=D=_=M=v=d=p=m=0,w=z*(F=t[h]),x=z*(A=t[h+1]),b=z*(C=t[h+2]),y=z*(U=t[h+3]),v+=B*F,d+=B*A,p+=B*C,m+=B*U,G=E,s=0;z>s;s=s+1|0)G.r=F,G.g=A,G.b=C,G.a=U,G=G.next;for(s=1;z>s;s=s+1|0)f=h+((s>O?O:s)<<2),v+=(G.r=F=t[f])*(P=z-s),d+=(G.g=A=t[f+1])*P,p+=(G.b=C=t[f+2])*P,m+=(G.a=U=t[f+3])*P,I+=F,D+=A,_+=C,M+=U,G=G.next;for(S=E,T=N,u=0;a>u;u=u+1|0)t[h+3]=U=m*k>>L,0!==U?(U=255/U,t[h]=(v*k>>L)*U,t[h+1]=(d*k>>L)*U,t[h+2]=(p*k>>L)*U):t[h]=t[h+1]=t[h+2]=0,v-=w,d-=x,p-=b,m-=y,w-=S.r,x-=S.g,b-=S.b,y-=S.a,f=g+((f=u+n+1)<O?f:O)<<2,I+=S.r=t[f],D+=S.g=t[f+1],_+=S.b=t[f+2],M+=S.a=t[f+3],v+=I,d+=D,p+=_,m+=M,S=S.next,w+=F=T.r,x+=A=T.g,b+=C=T.b,y+=U=T.a,I-=F,D-=A,_-=C,M-=U,T=T.next,h=h+4|0;g+=a}for(u=0;a>u;u=u+1|0){for(D=_=M=I=d=p=m=v=0,h=u<<2,w=z*(F=t[h]),x=z*(A=t[h+1]),b=z*(C=t[h+2]),y=z*(U=t[h+3]),v+=B*F,d+=B*A,p+=B*C,m+=B*U,G=E,l=a,s=0;z>s;s=s+1|0)G.r=F,G.g=A,G.b=C,G.a=U,G=G.next;for(s=1;n>=s;s=s+1|0)h=l+u<<2,v+=(G.r=F=t[h])*(P=z-s),d+=(G.g=A=t[h+1])*P,p+=(G.b=C=t[h+2])*P,m+=(G.a=U=t[h+3])*P,I+=F,D+=A,_+=C,M+=U,G=G.next,j>s&&(l+=a);for(h=u,S=E,T=N,c=0;i>c;c=c+1|0)f=h<<2,t[f+3]=U=m*k>>L,U>0?(U=255/U,t[f]=(v*k>>L)*U,t[f+1]=(d*k>>L)*U,t[f+2]=(p*k>>L)*U):t[f]=t[f+1]=t[f+2]=0,v-=w,d-=x,p-=b,m-=y,w-=S.r,x-=S.g,b-=S.b,y-=S.a,f=u+((f=c+z)<j?f:j)*a<<2,v+=I+=S.r=t[f],d+=D+=S.g=t[f+1],p+=_+=S.b=t[f+2],m+=M+=S.a=t[f+3],S=S.next,w+=F=T.r,x+=A=T.g,b+=C=T.b,y+=U=T.a,I-=F,D-=A,_-=C,M-=U,T=T.next,h+=a}},i._rgb=function(t,n,a,i){var u,c,s,f,l,h,g,v,d,p,m,w,x,b,y,I,D,_,M,F,A,C=n+n+1,U=a-1,P=i-1,N=n+1,q=N*(N+1)/2,O=new r,j=O;for(s=1;C>s;s=s+1|0)j=j.next=new r,s===N&&(A=j);j.next=O;var z=null,B=null;g=h=0;var E=e[n],G=o[n];for(c=0;i>c;c=c+1|0){for(b=y=I=v=d=p=0,m=N*(D=t[h]),w=N*(_=t[h+1]),x=N*(M=t[h+2]),v+=q*D,d+=q*_,p+=q*M,j=O,s=0;N>s;s=s+1|0)j.r=D,j.g=_,j.b=M,j=j.next;for(s=1;N>s;s=s+1|0)f=h+((s>U?U:s)<<2),v+=(j.r=D=t[f])*(F=N-s),d+=(j.g=_=t[f+1])*F,p+=(j.b=M=t[f+2])*F,b+=D,y+=_,I+=M,j=j.next;for(z=O,B=A,u=0;a>u;u=u+1|0)t[h]=v*E>>G,t[h+1]=d*E>>G,t[h+2]=p*E>>G,v-=m,d-=w,p-=x,m-=z.r,w-=z.g,x-=z.b,f=g+((f=u+n+1)<U?f:U)<<2,b+=z.r=t[f],y+=z.g=t[f+1],I+=z.b=t[f+2],v+=b,d+=y,p+=I,z=z.next,m+=D=B.r,w+=_=B.g,x+=M=B.b,b-=D,y-=_,I-=M,B=B.next,h=h+4|0;g+=a}for(u=0;a>u;u=u+1|0){for(y=I=b=d=p=v=0,h=u<<2,m=N*(D=t[h]),w=N*(_=t[h+1]),x=N*(M=t[h+2]),v+=q*D,d+=q*_,p+=q*M,j=O,l=a,s=0;N>s;s=s+1|0)j.r=D,j.g=_,j.b=M,j=j.next;for(s=1;n>=s;s=s+1|0)h=l+u<<2,v+=(j.r=D=t[h])*(F=N-s),d+=(j.g=_=t[h+1])*F,p+=(j.b=M=t[h+2])*F,b+=D,y+=_,I+=M,j=j.next,P>s&&(l+=a);for(h=u,z=O,B=A,c=0;i>c;c=c+1|0)f=h<<2,t[f]=v*E>>G,t[f+1]=d*E>>G,t[f+2]=p*E>>G,v-=m,d-=w,p-=x,m-=z.r,w-=z.g,x-=z.b,f=u+((f=c+N)<P?f:P)*a<<2,v+=b+=z.r=t[f],d+=y+=z.g=t[f+1],p+=I+=z.b=t[f+2],z=z.next,m+=D=B.r,w+=_=B.g,x+=M=B.b,b-=D,y-=_,I-=M,B=B.next,h+=a}},t}()}(window),function(t){"use strict";var n=t.Igata;n.Convolution=function(){function t(t){r.call(this,t)}var r=n.Filter,a=n._round,e=n._sqrt,o=n._floor,i=n._PI,u=n._exp;n.extend(r,t);var c=t.prototype;return c.constructor=t,c.filter=function(t){var n,r=this.bitmap,a=r.context,e=this.imageData(r);"undefined"==typeof t&&(t=[1,1,1,1,.7,-1,-1,-1,-1]),n=this.convolute(a,e,t,!0),a.putImageData(n,0,0)},c.sharpen=function(t){var n,r=this.bitmap,a=r.context,e=this.imageData(r),o=[0,-1,0,-1,5,-1,0,-1,0];t=!!t,n=this.convolute(a,e,o,t),a.putImageData(n,0,0)},c.blur=function(t){(isNaN(t)||0>=t)&&(t=1/9);var n,r=this.bitmap,a=r.context,e=this.imageData(r),o=[t,t,t,t,t,t,t,t,t];n=this.convolute(a,e,o,!1),a.putImageData(n,0,0)},c.gaussian=function(t){var n,r,a,o=this.bitmap,c=o.context,s=this.imageData(o),f=[],l=.849321800288,h=1/e(2*i)/l,g=0;for(r=-t;t>=r;r++)for(a=-t;t>=a;a++)g=h*u(-(a*a+r*r)/(2*l*l)),f.push(g);console.log("gaussian ",t,f),n=this.convolute(c,s,f,!1),c.putImageData(n,0,0)},c.convolute=function(t,n,r,i){var u,c,s,f,l,h,g,v,d,p,m,w,x,b,y,I=a(e(r.length)),D=o(.5*I),_=n.data,M=n.width,F=n.height,A=M,C=F,U=t.createImageData(A,C),P=U.data,N=i?1:0;for(u=0;C>u;u=u+1|0)for(c=0;A>c;c=c+1|0){for(s=u,f=c,l=4*(u*A+c),h=0,g=0,v=0,d=0,p=0;I>p;p=p+1|0)for(m=0;I>m;m=m+1|0)w=s+p-D,x=f+m-D,w>=0&&F>w&&x>=0&&M>x&&(b=4*(w*M+x),y=r[p*I+m],h+=_[b]*y,g+=_[b+1]*y,v+=_[b+2]*y,d+=_[b+3]*y);P[l]=h,P[l+1]=g,P[l+2]=v,P[l+3]=d+N*(255-d)}return U},t}()}(window),function(t){"use strict";var n=(t.document,t.Igata);n.Match=function(){function t(){}var r=n._abs,a=n._sqrt,e=t.prototype;return e.constructor=t,t.overall=function(t,n,r){var a,e,o=t[0].length===n[0].length?t[0].length:null,i=t.length===n.length?t.length:null;if(null===o||null===i)throw new Error("Matrices don't have the same size.");for(a=0;o>a;a=a+1|0)for(e=0;i>e;e=e+1|0)r(t[a][e],n[a][e])},t.mean=function(t){var n,r,a=0,e=t[0].length,o=t.length;for(n=0;e>n;n=n+1|0)for(r=0;o>r;r=r+1|0)a+=t[n][r];return console.log("mean ",a,e,o,a/(e*o)),a/(e*o)},t.sad=function(n,a){var e=0;return t.overall(n,a,function(t,n){e+=r(t-n)}),e},t.ssd=function(n,r){var a=0;return t.overall(n,r,function(t,n){var r=t-n;a+=r*r}),a},t.zncc=function(n,r){var e,o=t.mean(n),i=t.mean(r),u=0,c=0,s=0;return t.overall(n,r,function(t,n){var r=t-o,a=n-i;u+=r*a,c+=r*r,s+=a*a}),e=a(c*s),u/e},t}()}(window),function(t){"use strict";var n=(t.document,t.Igata);n.Template=function(){function t(){}var r=n.Grayscale,a=n._abs,e=t.prototype;return e.constructor=t,e.match=function(t,n,a){var e,o,i,u,c,s,f,l,h,g,v,d,p,m=new Uint8ClampedArray(t.data),w=new Uint8ClampedArray(n.data);for(a=a||.9,r.to(m),r.to(w),e=t.height,o=t.width,i=n.height,u=n.width,c=0,s=e-i+1;s>c;c=c+1|0)for(f=0,l=o-u+1;l>f;f=f+1|0)for(v=0,h=0;i>h;h=h+1|0)for(g=0;u>g;g=g+1|0)p=g+u*h,d=f+g+o*(c+h),m[d]===w[p]&&(v=v+1|0);return v>=u*i*a},e.sad=function(t,n,e){var o,i,u,c,s,f,l,h,g,v,d,p,m,w,x,b,y,I=new Uint8ClampedArray(t.data),D=new Uint8ClampedArray(n.data);e=e||.2,r.to(I),r.to(D),o=t.height,i=t.width,u=n.height,c=n.width,y=c*u*256;var _=Date.now();for(console.log("sad ",_),x=!1,s=0,f=o-u+1;f>s&&!x;s=s+1|0)for(l=0,h=i-c+1;h>l;l=l+1|0){for(d=0,g=0;u>g;g=g+1|0)for(v=0;c>v;v=v+1|0)w=v+c*g,m=l+v+i*(s+g),d+=a(I[m]-D[w]);if(p=d/y,e>=p){console.log("normal ",p,d,y),x=!0,b={normalize:p,similar:d,x:l,y:s,width:c,height:u};break}}return console.log("------------------------- ",(Date.now()-_)/1e3),b},t}()}(window);